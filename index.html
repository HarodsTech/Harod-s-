<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harod's Tech - Gestión Completa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
:root {
    --primary: #bb86fc;
    --secondary: #03dac6;
    --success: #00c853;
    --warning: #ffab00;
    --danger: #cf6679;
    --netflix: #e50914;
    --disney: #113ccf;
    --hbo: #9467fe;
    --prime: #00a8e1;
    --crunchyroll: #f47521;
    --spotify: #1db954;
    --bg-primary: #121212;
    --bg-secondary: #1e1e1e;
    --bg-card: #2d2d2d;
    --bg-hover: #383838;
    --text-primary: #ffffff;
    --text-secondary: #b0b0b0;
    --text-muted: #888888;
    --border-color: #404040;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.4);
    --glow: 0 0 20px rgba(187, 134, 252, 0.3);
    --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 50%, #0f0f0f 100%);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 80%, rgba(187, 134, 252, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(3, 218, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(207, 102, 121, 0.05) 0%, transparent 50%);
    z-index: -1;
    animation: backgroundShift 20s ease-in-out infinite;
}

@keyframes backgroundShift {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.1) rotate(180deg); }
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
}

/* Header con efecto neón */
header {
    background: linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(45, 45, 45, 0.95) 100%);
    color: var(--text-primary);
    padding: 25px 0;
    text-align: center;
    border-radius: 0 0 20px 20px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
}

header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(187, 134, 252, 0.2), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.logo {
    font-size: 2.8rem;
    font-weight: 800;
    margin-bottom: 10px;
    position: relative;
    display: inline-block;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(187, 134, 252, 0.5);
    animation: logoGlow 2s ease-in-out infinite alternate;
}

@keyframes logoGlow {
    from { text-shadow: 0 0 20px rgba(187, 134, 252, 0.5); }
    to { text-shadow: 0 0 30px rgba(187, 134, 252, 0.8), 0 0 40px rgba(3, 218, 198, 0.4); }
}

.tagline {
    font-size: 1.2rem;
    color: var(--text-secondary);
    font-weight: 300;
    letter-spacing: 1px;
}

/* Partículas animadas */
.animated-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.particle {
    position: absolute;
    background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
    border-radius: 50%;
    animation: float 6s infinite ease-in-out;
    opacity: 0.1;
}

@keyframes float {
    0%, 100% { 
        transform: translateY(0px) rotate(0deg) scale(1); 
    }
    33% { 
        transform: translateY(-20px) rotate(120deg) scale(1.2); 
    }
    66% { 
        transform: translateY(10px) rotate(240deg) scale(0.8); 
    }
}

/* Selector de temas mejorado */
.theme-selector {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.theme-btn {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--bg-primary);
    border: none;
    padding: 12px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    transition: var(--transition);
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--glow);
}

.theme-btn:hover {
    transform: scale(1.1) rotate(180deg);
    box-shadow: var(--shadow-hover);
}

.theme-options {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--bg-card);
    border-radius: 15px;
    box-shadow: var(--shadow);
    padding: 15px;
    min-width: 180px;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.theme-option {
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 8px;
    margin: 5px 0;
    transition: var(--transition);
    color: var(--text-primary);
    border: 1px solid transparent;
}

.theme-option:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    transform: translateX(5px);
}

/* Widgets modernos */
.widgets {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.weather-widget, .clock-widget {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 200px;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.weather-widget::before, .clock-widget::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(187, 134, 252, 0.1), transparent);
    transition: left 0.5s ease;
}

.weather-widget:hover::before, .clock-widget:hover::before {
    left: 100%;
}

.weather-widget:hover, .clock-widget:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
}

.weather-widget i {
    font-size: 2rem;
    color: var(--warning);
    filter: drop-shadow(0 0 10px rgba(255, 171, 0, 0.3));
}

.clock-widget {
    flex-direction: column;
    text-align: center;
    gap: 8px;
}

#currentTime {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary);
    text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
}

#currentDate {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

/* Tarjetas de estadísticas animadas */
.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.stat-card {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 20px;
    box-shadow: var(--shadow);
    text-align: center;
    transition: var(--transition);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.stat-card:hover::before {
    transform: scaleX(1);
}

.stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-hover), var(--glow);
}

.stat-card i {
    font-size: 2.5rem;
    color: var(--secondary);
    margin-bottom: 15px;
    filter: drop-shadow(0 0 10px rgba(3, 218, 198, 0.3));
    animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
}

.stat-number {
    font-size: 2.2rem;
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 5px;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.95rem;
    font-weight: 300;
}

/* Sección de login */
.login-section {
    background: var(--bg-card);
    padding: 40px;
    border-radius: 20px;
    box-shadow: var(--shadow);
    max-width: 450px;
    margin: 50px auto;
    text-align: center;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    transform: translateY(20px);
    opacity: 0;
    animation: fadeInUp 0.6s forwards;
    position: relative;
    overflow: hidden;
}

.login-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(transparent, rgba(187, 134, 252, 0.1), transparent 30%);
    animation: rotate 4s linear infinite;
}

@keyframes rotate {
    100% { transform: rotate(360deg); }
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.login-section h2 {
    margin-bottom: 20px;
    color: var(--primary);
    font-size: 2rem;
    position: relative;
}

.login-section input {
    width: 100%;
    padding: 15px;
    margin-bottom: 20px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 1rem;
    transition: var(--transition);
    color: var(--text-primary);
    position: relative;
    z-index: 1;
}

.login-section input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.2);
    outline: none;
    transform: scale(1.02);
}

.login-section button {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--bg-primary);
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    font-weight: 600;
    z-index: 1;
}

.login-section button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover), var(--glow);
}

/* Dashboard */
.dashboard {
    display: none;
    opacity: 0;
    animation: fadeIn 0.6s forwards;
}

@keyframes fadeIn {
    to { opacity: 1; }
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.welcome-message {
    font-size: 1.8rem;
    color: var(--primary);
    font-weight: 600;
    text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
}

.logout-btn {
    background: linear-gradient(135deg, var(--danger), #ff6b6b);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(207, 102, 121, 0.4);
}

/* Tabs modernas */
.tabs {
    display: flex;
    margin-bottom: 30px;
    border-bottom: 2px solid var(--border-color);
    flex-wrap: wrap;
    overflow-x: auto;
    gap: 5px;
}

.tab {
    padding: 15px 25px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: var(--transition);
    white-space: nowrap;
    position: relative;
    color: var(--text-secondary);
    font-weight: 500;
    border-radius: 10px 10px 0 0;
}

.tab.active {
    color: var(--primary);
    background: rgba(187, 134, 252, 0.1);
    border-bottom: 3px solid var(--primary);
}

.tab:hover:not(.active) {
    color: var(--text-primary);
    background: var(--bg-hover);
    transform: translateY(-2px);
}

.tab-content {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    transition: var(--transition);
}

.tab-content.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
    animation: fadeInContent 0.5s forwards;
}

@keyframes fadeInContent {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Formularios */
.client-form, .stock-form {
    background: var(--bg-card);
    padding: 30px;
    border-radius: 20px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    transition: var(--transition);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.client-form::before, .stock-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent, rgba(187, 134, 252, 0.05), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.client-form:hover::before, .stock-form:hover::before {
    opacity: 1;
}

.client-form:hover, .stock-form:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-5px);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
}

.form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 12px 15px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 1rem;
    transition: var(--transition);
    color: var(--text-primary);
}

.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.2);
    outline: none;
    transform: scale(1.02);
}

.form-row {
    display: flex;
    gap: 20px;
}

.form-row .form-group {
    flex: 1;
}

/* Botones mejorados */
.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1rem;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    min-height: 44px;
    min-width: 44px;
    font-weight: 600;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--bg-primary);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover), var(--glow);
}

.btn-success {
    background: linear-gradient(135deg, var(--success), #00e676);
    color: white;
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 200, 83, 0.4);
}

.btn-warning {
    background: linear-gradient(135deg, var(--warning), #ffd600);
    color: var(--bg-primary);
}

.btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 171, 0, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, var(--danger), #ff6b6b);
    color: white;
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(207, 102, 121, 0.4);
}

.btn-neon {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
    text-shadow: 0 0 5px currentColor;
    box-shadow: 0 0 15px var(--primary), inset 0 0 15px var(--primary);
    transition: all 0.3s ease;
}

.btn-neon:hover {
    background: var(--primary);
    color: var(--bg-primary);
    box-shadow: 0 0 25px var(--primary), 0 0 50px var(--primary);
    transform: translateY(-2px);
}

/* Listas y tarjetas */
.clients-list, .stock-list {
    background: var(--bg-card);
    border-radius: 20px;
    box-shadow: var(--shadow);
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
}

.client-item, .stock-item {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.client-item::before, .stock-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: linear-gradient(to bottom, var(--primary), var(--secondary));
    transform: scaleY(0);
    transition: transform 0.3s ease;
}

.client-item:hover::before, .stock-item:hover::before {
    transform: scaleY(1);
}

.client-item:hover, .stock-item:hover {
    background: var(--bg-hover);
    transform: translateX(5px);
}

.client-item:last-child, .stock-item:last-child {
    border-bottom: none;
}

.client-info, .stock-info {
    flex: 1;
    min-width: 250px;
}

.client-name, .stock-name {
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.client-details, .stock-details {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.client-actions, .stock-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.status-overdue {
    color: var(--danger);
    font-weight: bold;
    text-shadow: 0 0 10px rgba(207, 102, 121, 0.3);
}

.status-pending {
    color: var(--warning);
    font-weight: bold;
    text-shadow: 0 0 10px rgba(255, 171, 0, 0.3);
}

.status-paid {
    color: var(--success);
    font-weight: bold;
    text-shadow: 0 0 10px rgba(0, 200, 83, 0.3);
}

/* Barra de búsqueda */
.search-bar {
    margin-bottom: 25px;
    display: flex;
    gap: 15px;
}

.search-bar input {
    flex: 1;
    padding: 12px 20px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    font-size: 1rem;
    transition: var(--transition);
    color: var(--text-primary);
}

.search-bar input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.2);
    outline: none;
    transform: scale(1.02);
}

.search-bar button {
    padding: 12px 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--bg-primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
}

.search-bar button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover), var(--glow);
}

/* Grid de stock */
.stock-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 25px;
    margin-top: 25px;
}

.stock-card {
    background: var(--bg-card);
    border-radius: 20px;
    box-shadow: var(--shadow);
    padding: 25px;
    position: relative;
    border-top: 5px solid;
    transition: var(--transition);
    transform: translateY(0);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    overflow: hidden;
}

.stock-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stock-card:hover::before {
    opacity: 1;
}

.stock-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-hover), var(--glow);
}

.stock-card.netflix {
    border-color: var(--netflix);
    background: linear-gradient(135deg, var(--bg-card), #1a0f0f);
}

.stock-card.disney {
    border-color: var(--disney);
    background: linear-gradient(135deg, var(--bg-card), #0f1525);
}

.stock-card.hbo {
    border-color: var(--hbo);
    background: linear-gradient(135deg, var(--bg-card), #1a1525);
}

.stock-card.prime {
    border-color: var(--prime);
    background: linear-gradient(135deg, var(--bg-card), #0f1a25);
}

.stock-card.crunchyroll {
    border-color: var(--crunchyroll);
    background: linear-gradient(135deg, var(--bg-card), #251a0f);
}

.stock-card.spotify {
    border-color: var(--spotify);
    background: linear-gradient(135deg, var(--bg-card), #0f251a);
}

.stock-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.stock-title {
    font-weight: bold;
    font-size: 1.3rem;
    color: var(--text-primary);
}

.stock-count {
    font-size: 1.6rem;
    font-weight: bold;
}

.stock-email {
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.stock-profiles {
    margin-bottom: 20px;
}

.profile-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
}

.profile-item:hover {
    background: var(--bg-hover);
    transform: translateX(5px);
    border-radius: 5px;
    padding-left: 10px;
}

.profile-item:last-child {
    border-bottom: none;
}

.stock-actions-card {
    display: flex;
    gap: 10px;
}

.stock-actions-card button {
    flex: 1;
}

.low-stock {
    color: var(--danger);
    text-shadow: 0 0 10px rgba(207, 102, 121, 0.3);
}

.medium-stock {
    color: var(--warning);
    text-shadow: 0 0 10px rgba(255, 171, 0, 0.3);
}

.high-stock {
    color: var(--success);
    text-shadow: 0 0 10px rgba(0, 200, 83, 0.3);
}

/* Mensajes */
.loading {
    text-align: center;
    padding: 30px;
    color: var(--secondary);
    font-size: 1.1rem;
}

.error-message {
    background: linear-gradient(135deg, rgba(207, 102, 121, 0.1), rgba(255, 107, 107, 0.1));
    color: var(--danger);
    padding: 15px 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border-left: 4px solid var(--danger);
    animation: shake 0.5s;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(207, 102, 121, 0.3);
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.success-message {
    background: linear-gradient(135deg, rgba(0, 200, 83, 0.1), rgba(0, 230, 118, 0.1));
    color: var(--success);
    padding: 15px 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border-left: 4px solid var(--success);
    animation: slideIn 0.5s;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 200, 83, 0.3);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Modales */
.edit-stock-modal, .edit-client-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s;
    backdrop-filter: blur(5px);
}

.edit-stock-content, .edit-client-content {
    background: var(--bg-card);
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    transform: scale(0.9);
    animation: zoomIn 0.3s forwards;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    position: relative;
}

@keyframes zoomIn {
    to {
        transform: scale(1);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    transition: var(--transition);
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.close-modal:hover {
    color: var(--danger);
    transform: rotate(90deg);
    background: rgba(207, 102, 121, 0.1);
}

/* Menú móvil */
.mobile-menu-btn {
    display: none;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    font-size: 1.5rem;
    color: var(--bg-primary);
    cursor: pointer;
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1001;
    transition: var(--transition);
    min-height: 44px;
    min-width: 44px;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
}

.mobile-menu-btn:hover {
    transform: scale(1.1) rotate(90deg);
}

.mobile-tabs {
    display: none;
    flex-direction: column;
    background: var(--bg-card);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    position: relative;
    z-index: 999;
    animation: slideDown 0.3s ease-out;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
}

.mobile-tabs.show {
    display: flex;
}

.mobile-tab {
    padding: 18px 20px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: var(--transition);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 12px;
    min-height: 44px;
    color: var(--text-primary);
    position: relative;
    overflow: hidden;
}

.mobile-tab:last-child {
    border-bottom: none;
}

.mobile-tab.active {
    background: linear-gradient(135deg, rgba(187, 134, 252, 0.2), rgba(3, 218, 198, 0.1));
    color: var(--primary);
}

.mobile-tab.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: linear-gradient(to bottom, var(--primary), var(--secondary));
}

.mobile-tab:hover:not(.active) {
    background: var(--bg-hover);
    transform: translateX(5px);
    padding-left: 25px;
}

.mobile-tab i {
    width: 20px;
    text-align: center;
    font-size: 1.1rem;
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 15px;
    }
    
    .logo {
        font-size: 2.2rem;
    }
    
    .stats-cards {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .search-bar {
        flex-direction: column;
    }
    
    .client-actions, .stock-actions {
        flex-direction: column;
    }
    
    .stock-grid {
        grid-template-columns: 1fr;
    }
    
    .mobile-menu-btn {
        display: flex;
    }
    
    .tabs {
        display: none;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 10px;
    }
    
    .login-section {
        padding: 25px;
        margin: 20px auto;
    }
    
    .client-form, .stock-form {
        padding: 20px;
    }
    
    .edit-stock-content, .edit-client-content {
        padding: 20px;
        margin: 10px;
    }
}
</style>
</head>
<body>
    <!-- Fondo animado con partículas -->
    <div class="animated-bg" id="animatedBg"></div>
    
    <!-- Selector de temas -->
    <div class="theme-selector">
        <button class="theme-btn" id="themeBtn">
            <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options" id="themeOptions">
            <div class="theme-option" data-theme="default">Tema Azul</div>
            <div class="theme-option" data-theme="dark">Tema Oscuro</div>
            <div class="theme-option" data-theme="green">Tema Verde</div>
            <div class="theme-option" data-theme="purple">Tema Púrpura</div>
        </div>
    </div>
    
    <!-- Reproductor de música 
    <div class="music-player">
        <div class="music-controls">
            <button id="musicToggle" class="btn" style="background: transparent; color: white; padding: 5px;">
                <i class="fas fa-play" id="musicIcon"></i>
            </button>
            <div class="music-info">
                <span id="musicStatus">Música OFF</span>
            </div>
            <div class="volume-control">
                <i class="fas fa-volume-down"></i>
                <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="0.5">
            </div>
        </div>
        <audio id="backgroundMusic" loop>
            Reemplaza con tu archivo de música 
            <source src="https://assets.codepen.io/1468070/BackgroundMusic.mp3" type="audio/mpeg">
            Tu navegador no soporta el elemento de audio.
        </audio>
    </div>
    
  Efectos de sonido 
    <audio id="clickSound" preload="auto">
        <source src="https://assets.codepen.io/1468070/Click.mp3" type="audio/mpeg">
    </audio>
    <audio id="successSound" preload="auto">
        <source src="https://assets.codepen.io/1468070/Success.mp3" type="audio/mpeg">
    </audio>
    <audio id="errorSound" preload="auto">
        <source src="https://assets.codepen.io/1468070/Error.mp3" type="audio/mpeg">
    </audio>
-->
    
    <header>
        <div class="container">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">Harod's Tech</div>
            <div class="tagline">Gestión de Clientes y Stock</div>
        </div>
    </header>
    
    <div class="container">
        <!-- Sección de Login -->
        <div id="loginSection" class="login-section">
            <h2>Acceso Administrativo</h2>
            <p>Solo el propietario puede acceder a esta área</p>
            <input type="password" id="password" placeholder="Contraseña de acceso">
            <button id="loginBtn">Ingresar</button>
        </div>
        
        <!-- Dashboard (oculto inicialmente) -->
        <div id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <div class="welcome-message">Bienvenido a Harod's Tech</div>
                <button id="logoutBtn" class="logout-btn">Cerrar Sesión</button>
            </div>
            
            <!-- Widgets -->
            <div class="widgets">
                <div class="weather-widget">
                    <i class="fas fa-sun"></i>
                    <div>
                        <div id="temperature">--°C</div>
                        <div id="location">Tegucigalpa</div>
                    </div>
                </div>
                <div class="clock-widget">
                    <div id="currentTime">--:--:--</div>
                    <div id="currentDate">-- --- ----</div>
                </div>
            </div>
            
            <!-- Tarjetas de estadísticas -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Clientes Activos</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-boxes"></i>
                    <div class="stat-number" id="totalStock">0</div>
                    <div class="stat-label">Cuentas en Stock</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="stat-number" id="pendingPayments">0</div>
                    <div class="stat-label">Pagos Pendientes</div>
                </div>
            </div>
            
            <!-- Menú móvil -->
            <div class="mobile-tabs" id="mobileTabs">
                <div class="mobile-tab active" data-tab="clients">Lista de Clientes</div>
                <div class="mobile-tab" data-tab="addClient">Agregar Cliente</div>
                <div class="mobile-tab" data-tab="stock">Stock de Servicios</div>
                <div class="mobile-tab" data-tab="addStock">Agregar Stock</div>
                <div class="mobile-tab" data-tab="backup">Respaldo</div>
            </div>
            
            <!-- Menú de escritorio -->
            <div class="tabs">
                <div class="tab active" data-tab="clients">Lista de Clientes</div>
                <div class="tab" data-tab="addClient">Agregar Cliente</div>
                <div class="tab" data-tab="stock">Stock de Servicios</div>
                <div class="tab" data-tab="addStock">Agregar Stock</div>
                <div class="tab" data-tab="backup">Respaldo</div>
            </div>

            <!-- Mensajes de estado -->
            <div id="messageContainer"></div>
            
            <!-- Contenido de la pestaña Lista de Clientes -->
            <div id="clientsTab" class="tab-content active">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Buscar cliente...">
                    <button id="searchBtn">Buscar</button>
                    <button id="refreshClientsBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                
                <div class="clients-list" id="clientsList">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Cargando clientes...
                    </div>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Agregar Cliente -->
            <div id="addClientTab" class="tab-content">
                <div class="client-form">
                    <h3>Agregar Nuevo Cliente</h3>
                    <form id="addClientForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientName">Nombre del Cliente</label>
                                <input type="text" id="clientName" required>
                            </div>
                            <div class="form-group">
                                <label for="clientPhone">Número de Teléfono</label>
                                <div class="phone-prefix">
                                    <span>+504</span>
                                    <input type="tel" id="clientPhone" placeholder="XXXXXXXX" maxlength="8" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceType">Cuenta de Servicio</label>
                                <select id="serviceType" required>
                                    <option value="">Selecciona una cuenta</option>
                                    <!-- Las opciones se cargarán dinámicamente -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profileAssigned">Perfil Asignado</label>
                                <select id="profileAssigned" required>
                                    <option value="">Primero selecciona una cuenta</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="purchaseDate">Fecha de Compra</label>
                                <input type="date" id="purchaseDate" required>
                            </div>
                            <div class="form-group">
                                <label for="paymentDeadline">Fecha Límite de Pago</label>
                                <input type="date" id="paymentDeadline" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginDetails">Detalles de Acceso (usuario/contraseña)</label>
                            <textarea id="loginDetails" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentStatus">Estado de Pago</label>
                            <select id="paymentStatus">
                                <option value="pending">Pendiente</option>
                                <option value="paid">Pagado</option>
                                <option value="overdue">Vencido</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="clientNotes">Notas (opcional)</label>
                            <textarea id="clientNotes" rows="2" placeholder="Notas adicionales sobre el cliente..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-neon">
                            <i class="fas fa-plus"></i> Agregar Cliente
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Stock de Servicios -->
            <div id="stockTab" class="tab-content">
                <div class="search-bar">
                    <input type="text" id="stockSearchInput" placeholder="Buscar servicio...">
                    <button id="stockSearchBtn">Buscar</button>
                    <button id="refreshStockBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                
                <div class="stock-grid" id="stockGrid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Cargando stock...
                    </div>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Agregar Stock -->
            <div id="addStockTab" class="tab-content">
                <div class="stock-form">
                    <h3>Agregar Nueva Cuenta</h3>
                    <form id="addStockForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceName">Servicio</label>
                                <select id="serviceName" required>
                                    <option value="">Selecciona un servicio</option>
                                    <option value="Netflix">Netflix</option>
                                    <option value="Disney+">Disney+</option>
                                    <option value="HBO Max">HBO Max</option>
                                    <option value="Prime Video">Prime Video</option>
                                    <option value="Crunchyroll">Crunchyroll</option>
                                    <option value="Spotify">Spotify</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="accountName">Nombre de la Cuenta</label>
                                <input type="text" id="accountName" placeholder="Ej: Netflix Principal, Netflix Secundario" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="stockQuantity">Cupos Disponibles</label>
                                <input type="number" id="stockQuantity" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="totalCapacity">Capacidad Total</label>
                                <input type="number" id="totalCapacity" min="1" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="servicePrice">Precio del Servicio ($)</label>
                                <input type="number" id="servicePrice" min="0" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="accountEmail">Correo de la Cuenta</label>
                            <input type="email" id="accountEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="accountPassword">Contraseña de la Cuenta</label>
                            <input type="text" id="accountPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="profilesAvailable">Perfiles Disponibles (separados por coma)</label>
                            <input type="text" id="profilesAvailable" placeholder="Ej: Perfil 1, Perfil 2, Perfil 3" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-neon">
                            <i class="fas fa-plus"></i> Agregar Cuenta
                        </button>
                    </form>
                </div>
            </div>

            <!-- Contenido de la pestaña Respaldo -->
            <div id="backupTab" class="tab-content">
                <div class="backup-section">
                    <h3>Respaldo de Datos</h3>
                    <p>Gestiona tus archivos de datos y realiza respaldos.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <button id="exportDataBtn" class="btn btn-success">
                                <i class="fas fa-download"></i> Exportar Todos los Datos
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="importDataBtn" class="btn btn-warning">
                                <i class="fas fa-upload"></i> Importar Datos
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <button id="backupClientsBtn" class="btn btn-primary">
                                <i class="fas fa-file-export"></i> Respaldar Clientes
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="backupStockBtn" class="btn btn-primary">
                                <i class="fas fa-file-export"></i> Respaldar Stock
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <h4>Archivos de Datos</h4>
                        <div id="fileList">
                            <div class="loading">Cargando archivos...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar stock -->
    <div id="editStockModal" class="edit-stock-modal">
        <div class="edit-stock-content">
            <div class="modal-header">
                <h3>Editar Cuenta</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editStockForm">
                <input type="hidden" id="editStockId">
                <div class="form-group">
                    <label for="editServiceName">Servicio</label>
                    <input type="text" id="editServiceName" readonly>
                </div>
                <div class="form-group">
                    <label for="editAccountName">Nombre de la Cuenta</label>
                    <input type="text" id="editAccountName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editStockQuantity">Cupos Disponibles</label>
                        <input type="number" id="editStockQuantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="editTotalCapacity">Capacidad Total</label>
                        <input type="number" id="editTotalCapacity" min="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editAccountEmail">Correo de la Cuenta</label>
                    <input type="email" id="editAccountEmail" required>
                </div>
                <div class="form-group">
                    <label for="editAccountPassword">Contraseña de la Cuenta</label>
                    <input type="text" id="editAccountPassword" required>
                </div>
                <div class="form-group">
                    <label for="editProfilesAvailable">Perfiles Disponibles (separados por coma)</label>
                    <input type="text" id="editProfilesAvailable" required>
                </div>
                <div class="form-group">
                    <label for="editServicePrice">Precio del Servicio ($)</label>
                    <input type="number" id="editServicePrice" min="0" step="0.01" required>
                </div>
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn btn-danger" id="cancelEditBtn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para editar cliente -->
    <div id="editClientModal" class="edit-client-modal">
        <div class="edit-client-content">
            <div class="modal-header">
                <h3>Editar Cliente</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editClientForm">
                <input type="hidden" id="editClientId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editClientName">Nombre del Cliente</label>
                        <input type="text" id="editClientName" required>
                    </div>
                    <div class="form-group">
                        <label for="editClientPhone">Número de Teléfono</label>
                        <div class="phone-prefix">
                            <span>+504</span>
                            <input type="tel" id="editClientPhone" placeholder="XXXXXXXX" maxlength="8" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editServiceType">Cuenta de Servicio</label>
                        <select id="editServiceType" required>
                            <option value="">Selecciona una cuenta</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editProfileAssigned">Perfil Asignado</label>
                        <select id="editProfileAssigned" required>
                            <option value="">Primero selecciona una cuenta</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editPurchaseDate">Fecha de Compra</label>
                        <input type="date" id="editPurchaseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editPaymentDeadline">Fecha Límite de Pago</label>
                        <input type="date" id="editPaymentDeadline" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editLoginDetails">Detalles de Acceso (usuario/contraseña)</label>
                    <textarea id="editLoginDetails" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editPaymentStatus">Estado de Pago</label>
                    <select id="editPaymentStatus">
                        <option value="pending">Pendiente</option>
                        <option value="paid">Pagado</option>
                        <option value="overdue">Vencido</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editClientNotes">Notas (opcional)</label>
                    <textarea id="editClientNotes" rows="2" placeholder="Notas adicionales sobre el cliente..."></textarea>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn btn-danger" id="cancelEditClientBtn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuración
        const ACCESS_PASSWORD = "HarodTech2023";
        const SESSION_KEY = "harods_tech_session";
        const DATA_FILES = {
            clients: 'harods_tech_clientes',
            stock: 'harods_tech_stock'
        };

        // Elementos del DOM
        const loginSection = document.getElementById('loginSection');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const passwordInput = document.getElementById('password');
        const tabs = document.querySelectorAll('.tab');
 
        const tabContents = document.querySelectorAll('.tab-content');
        const clientsList = document.getElementById('clientsList');
        const addClientForm = document.getElementById('addClientForm');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const stockGrid = document.getElementById('stockGrid');
        const addStockForm = document.getElementById('addStockForm');
        const stockSearchInput = document.getElementById('stockSearchInput');
        const stockSearchBtn = document.getElementById('stockSearchBtn');
        const refreshClientsBtn = document.getElementById('refreshClientsBtn');
        const refreshStockBtn = document.getElementById('refreshStockBtn');
        const serviceTypeSelect = document.getElementById('serviceType');
        const profileAssignedSelect = document.getElementById('profileAssigned');
        const messageContainer = document.getElementById('messageContainer');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFile = document.getElementById('importFile');
        const backupClientsBtn = document.getElementById('backupClientsBtn');
        const backupStockBtn = document.getElementById('backupStockBtn');
        const fileList = document.getElementById('fileList');
        
        // Elementos del modal de edición
        const editStockModal = document.getElementById('editStockModal');
        const editStockForm = document.getElementById('editStockForm');
        const closeModalBtn = document.querySelectorAll('.close-modal');
        const cancelEditBtn = document.getElementById('cancelEditBtn');

        // Elementos del modal de edición de cliente
        const editClientModal = document.getElementById('editClientModal');
        const editClientForm = document.getElementById('editClientForm');
        const cancelEditClientBtn = document.getElementById('cancelEditClientBtn');
        
        // Nuevos elementos para las mejoras
        const themeBtn = document.getElementById('themeBtn');
        const themeOptions = document.getElementById('themeOptions');
        const animatedBg = document.getElementById('animatedBg');
        const musicToggle = document.getElementById('musicToggle');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicStatus = document.getElementById('musicStatus');
        const musicIcon = document.getElementById('musicIcon');
        const volumeSlider = document.getElementById('volumeSlider');
        const currentTimeElement = document.getElementById('currentTime');
        const currentDateElement = document.getElementById('currentDate');
        const totalClientsElement = document.getElementById('totalClients');
        const totalStockElement = document.getElementById('totalStock');
        const pendingPaymentsElement = document.getElementById('pendingPayments');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const mobileTabsContainer = document.getElementById('mobileTabs');
const mobileTabs = document.querySelectorAll('.mobile-tab');

        // Estado de la aplicación
        let clients = [];
        let stock = [];
        let currentEditingStock = null;
        let currentEditingClient = null;
        let originalClients = [];
        let originalStock = [];
        let isMusicPlaying = false;
let isMobileMenuOpen = false;
        // Sistema de Sesión
        class SessionManager {
            static isLoggedIn() {
                return localStorage.getItem(SESSION_KEY) === 'true';
            }

            static login() {
                localStorage.setItem(SESSION_KEY, 'true');
            }

            static logout() {
                localStorage.removeItem(SESSION_KEY);
            }
        }

        // Utilidades
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.innerHTML = `
                <i class="fas ${type === 'error' ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                ${message}
            `;
            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatPhoneNumber(phone) {

    if (!phone) {
        return '+504';
    }
    
    if (phone.startsWith('+504')) {
        return phone;
    }
   
    if (phone.length === 8 && /^\d+$/.test(phone)) {
        return `+504${phone}`;
    }
    return phone;
}

        function getPhoneWithoutPrefix(phone) {
 
    if (!phone) {
        return '';
    }
    
    // Remover el prefijo +504 si está presente
    return phone.replace(/^\+504/, '');
}

        // Sistema de Archivos (simulado con localStorage)
        class FileSystem {
            static saveToFile(filename, data) {
                try {
                    const fileData = {
                        content: data,
                        timestamp: new Date().toISOString(),
                        size: JSON.stringify(data).length
                    };
                    localStorage.setItem(filename, JSON.stringify(fileData));
                    return true;
                } catch (error) {
                    console.error('Error guardando archivo:', error);
                    return false;
                }
            }

            static loadFromFile(filename) {
                try {
                    const fileData = localStorage.getItem(filename);
                    if (!fileData) return null;
                    
                    const parsed = JSON.parse(fileData);
                    return parsed.content;
                } catch (error) {
                    console.error('Error cargando archivo:', error);
                    return null;
                }
            }

            static downloadFile(filename, content, type = 'text/plain') {
                const blob = new Blob([content], { type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            static listFiles() {
                const files = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('harods_tech_')) {
                        try {
                            const fileData = JSON.parse(localStorage.getItem(key));
                            files.push({
                                name: key,
                                timestamp: fileData.timestamp,
                                size: fileData.size
                            });
                        } catch (e) {
                            // Ignorar elementos que no son archivos válidos
                        }
                    }
                }
                return files.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }
        }

        // Funciones para Clientes
        async function loadClients() {
            try {
                clientsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando clientes...</div>';
                
                const data = FileSystem.loadFromFile(DATA_FILES.clients);
                clients = data || [];
                originalClients = [...clients];
                
                renderClients();
                updateServiceOptions();
                updateStats();
            } catch (error) {
                showMessage('Error cargando clientes: ' + error.message, 'error');
                clientsList.innerHTML = '<div class="error-message">Error al cargar los clientes</div>';
            }
        }

        async function saveClients() {
            const success = FileSystem.saveToFile(DATA_FILES.clients, clients);
            if (!success) {
                showMessage('Error guardando clientes', 'error');
            }
            return success;
        }

        async function addClient(clientData) {
            try {
                // Verificar si ya existe un cliente con el mismo teléfono
                const existingClient = clients.find(c => c.phone === formatPhoneNumber(clientData.phone));
                if (existingClient) {
                    throw new Error('Ya existe un cliente con este número de teléfono');
                }

                const newClient = {
                    id: generateId(),
                    ...clientData,
                    phone: formatPhoneNumber(clientData.phone), // Formatear teléfono
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                clients.push(newClient);
                const success = await saveClients();
                
                if (success) {
                    showMessage('Cliente agregado exitosamente');
                    playSound('successSound');
                    await loadClients();
                    return newClient;
                } else {
                    throw new Error('Error guardando cliente');
                }
            } catch (error) {
                throw new Error('Error agregando cliente: ' + error.message);
            }
        }

        async function updateClient(clientId, clientData) {
    try {
        const index = clients.findIndex(c => c.id === clientId);
        if (index === -1) throw new Error('Cliente no encontrado');
        
        // Verificar si el teléfono ya existe en otro cliente
        const existingClient = clients.find(c => c.id !== clientId && c.phone === formatPhoneNumber(clientData.phone));
        if (existingClient) {
            throw new Error('Ya existe otro cliente con este número de teléfono');
        }
        
        clients[index] = {
            ...clients[index],
            ...clientData,
            phone: formatPhoneNumber(clientData.phone), // Formatear teléfono
            updatedAt: new Date().toISOString()
        };
        
        const success = await saveClients();
        if (success) {
            showMessage('Cliente actualizado exitosamente');
            playSound('successSound');
            await loadClients();
            return clients[index];
        } else {
            throw new Error('Error guardando cambios');
        }
    } catch (error) {
        throw new Error('Error actualizando cliente: ' + error.message);
    }
}

        async function deleteClient(clientId) {
            try {
                clients = clients.filter(c => c.id !== clientId);
                const success = await saveClients();
                
                if (success) {
                    showMessage('Cliente eliminado exitosamente');
                    playSound('successSound');
                    await loadClients();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error eliminando cliente: ' + error.message);
            }
        }

        // Funciones para Stock
        async function loadStock() {
            try {
                stockGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando stock...</div>';
                
                const data = FileSystem.loadFromFile(DATA_FILES.stock);
                stock = data || [];
                originalStock = [...stock];
                
                renderStock();
                updateServiceOptions();
                updateStats();
            } catch (error) {
                showMessage('Error cargando stock: ' + error.message, 'error');
                stockGrid.innerHTML = '<div class="error-message">Error al cargar el stock</div>';
            }
        }

        async function saveStock() {
            const success = FileSystem.saveToFile(DATA_FILES.stock, stock);
            if (!success) {
                showMessage('Error guardando stock', 'error');
            }
            return success;
        }

        async function addStock(stockData) {
            try {
                // Verificar si ya existe una cuenta con el mismo nombre
                const existingStock = stock.find(s => s.accountName === stockData.accountName && s.service === stockData.service);
                if (existingStock) {
                    throw new Error('Ya existe una cuenta con este nombre para este servicio');
                }

                // Crear nueva cuenta
                const newStock = {
                    id: generateId(),
                    ...stockData,
                    profiles: stockData.profiles.split(',').map(p => p.trim()),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                stock.push(newStock);
                
                const success = await saveStock();
                
                if (success) {
                    showMessage('Cuenta agregada exitosamente');
                    playSound('successSound');
                    await loadStock();
                    return stock;
                } else {
                    throw new Error('Error guardando stock');
                }
            } catch (error) {
                throw new Error('Error agregando stock: ' + error.message);
            }
        }

        async function updateStock(stockId, stockData) {
            try {
                const index = stock.findIndex(s => s.id === stockId);
                if (index === -1) throw new Error('Stock no encontrado');
                
                // Verificar si el nombre ya existe en otra cuenta
                const existingStock = stock.find(s => s.id !== stockId && s.accountName === stockData.accountName && s.service === stockData.service);
                if (existingStock) {
                    throw new Error('Ya existe otra cuenta con este nombre para este servicio');
                }
                
                stock[index] = {
                    ...stock[index],
                    ...stockData,
                    profiles: stockData.profiles.split(',').map(p => p.trim()),
                    updatedAt: new Date().toISOString()
                };
                
                const success = await saveStock();
                if (success) {
                    showMessage('Cuenta actualizada exitosamente');
                    playSound('successSound');
                    await loadStock();
                    return stock[index];
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error actualizando stock: ' + error.message);
            }
        }

        async function deleteStock(stockId) {
            try {
                // Verificar si hay clientes usando esta cuenta
                const clientsUsingStock = clients.filter(c => c.stockId === stockId);
                if (clientsUsingStock.length > 0) {
                    throw new Error(`No se puede eliminar esta cuenta porque ${clientsUsingStock.length} cliente(s) la están usando`);
                }

                stock = stock.filter(s => s.id !== stockId);
                const success = await saveStock();
                
                if (success) {
                    showMessage('Cuenta eliminada exitosamente');
                    playSound('successSound');
                    await loadStock();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error eliminando stock: ' + error.message);
            }
        }

        async function assignProfile(stockId, profileName) {
            try {
                const stockItem = stock.find(s => s.id === stockId);
                if (!stockItem) throw new Error('Cuenta no encontrada');
                
                const profileIndex = stockItem.profiles.indexOf(profileName);
                if (profileIndex === -1) throw new Error('Perfil no disponible');
                
                // Remover perfil y reducir cantidad
                stockItem.profiles.splice(profileIndex, 1);
                stockItem.quantity -= 1;
                stockItem.updatedAt = new Date().toISOString();
                
                const success = await saveStock();
                if (success) {
                    showMessage('Perfil asignado exitosamente');
                    playSound('successSound');
                    await loadStock();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error asignando perfil: ' + error.message);
            }
        }

        async function releaseProfile(stockId, profileName) {
            try {
                const stockItem = stock.find(s => s.id === stockId);
                if (!stockItem) throw new Error('Cuenta no encontrada');
                
                // Agregar perfil y aumentar cantidad
                stockItem.profiles.push(profileName);
                stockItem.quantity += 1;
                stockItem.updatedAt = new Date().toISOString();
                
                const success = await saveStock();
                if (!success) {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error liberando perfil: ' + error.message);
            }
        }

        // Funciones de Renderizado
        function renderClients() {
            clientsList.innerHTML = '';
            
            if (clients.length === 0) {
                clientsList.innerHTML = '<div class="client-item">No se encontraron clientes</div>';
                return;
            }
            
            clients.forEach(client => {
                const clientItem = document.createElement('div');
                clientItem.className = 'client-item';
                
                const statusClass = `status-${client.status}`;
                const statusText = client.status === 'paid' ? 'Pagado' : 
                                 client.status === 'overdue' ? 'Vencido' : 'Pendiente';
                
                clientItem.innerHTML = `
                    <div class="client-info">
                        <div class="client-name">${client.name}</div>
                        <div class="client-details">
                            <div><strong>Teléfono:</strong> ${client.phone}</div>
                            <div><strong>Cuenta:</strong> ${client.accountName} - ${client.profile}</div>
                            <div><strong>Compra:</strong> ${formatDate(client.purchaseDate)}</div>
                            <div><strong>Vence:</strong> ${formatDate(client.paymentDeadline)}</div>
                            <div><strong>Acceso:</strong> ${client.loginDetails}</div>
                            <div class="${statusClass}"><strong>Estado:</strong> ${statusText}</div>
                            ${client.notes ? `<div><strong>Notas:</strong> ${client.notes}</div>` : ''}
                        </div>
                    </div>
                    <div class="client-actions">
                        <button class="btn btn-warning" onclick="handleEditClient('${client.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-success" onclick="handleSendReminder('${client.id}')">
                            <i class="fas fa-bell"></i> Recordatorio
                        </button>
                        <button class="btn btn-primary" onclick="handleMarkAsPaid('${client.id}')">
                            <i class="fas fa-check-circle"></i> Pagado
                        </button>
                        <button class="btn btn-danger" onclick="handleCancelSubscription('${client.id}')">
                            <i class="fas fa-times-circle"></i> Cancelar
                        </button>
                    </div>
                `;
                
                clientsList.appendChild(clientItem);
            });
        }

        function renderStock() {
            stockGrid.innerHTML = '';
            
            if (stock.length === 0) {
                stockGrid.innerHTML = '<div class="stock-item">No se encontraron cuentas en stock</div>';
                return;
            }
            
            stock.forEach(item => {
                const stockCard = document.createElement('div');
                stockCard.className = `stock-card ${item.service.toLowerCase().replace('+', '').replace(' ', '')}`;
                
                let stockClass = '';
                if (item.quantity === 0) {
                    stockClass = 'low-stock';
                } else if (item.quantity <= item.total * 0.3) {
                    stockClass = 'low-stock';
                } else if (item.quantity <= item.total * 0.6) {
                    stockClass = 'medium-stock';
                } else {
                    stockClass = 'high-stock';
                }
                
                stockCard.innerHTML = `
                    <div class="stock-header">
                        <div class="stock-title">${item.accountName || item.service}</div>
                        <div class="stock-count ${stockClass}">${item.quantity}/${item.total}</div>
                    </div>
                    <div class="stock-details">
                        <div><strong>Servicio:</strong> ${item.service}</div>
                        <div><strong>Email:</strong> ${item.email}</div>
                        <div><strong>Precio:</strong> $${item.price}</div>
                    </div>
                    <div class="stock-profiles">
                        <div><strong>Perfiles disponibles (${item.profiles.length}):</strong></div>
                        ${item.profiles.map(profile => `
                            <div class="profile-item">
                                <span>${profile}</span>
                                <span>
                                    <button class="btn btn-primary btn-sm" onclick="handleAssignProfile('${item.id}', '${profile}')">
                                        <i class="fas fa-user-plus"></i> Asignar
                                    </button>
                                </span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="stock-actions-card">
                        <button class="btn btn-warning" onclick="handleEditStock('${item.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger" onclick="handleDeleteStock('${item.id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                stockGrid.appendChild(stockCard);
            });
        }

        function updateServiceOptions() {
            serviceTypeSelect.innerHTML = '<option value="">Selecciona una cuenta</option>';
            profileAssignedSelect.innerHTML = '<option value="">Primero selecciona una cuenta</option>';
            
            stock.forEach(item => {
                if (item.quantity > 0) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.accountName || item.service} (${item.quantity} disponibles)`;
                    serviceTypeSelect.appendChild(option);
                }
            });
        }

        function updateProfileOptions(stockId) {
            profileAssignedSelect.innerHTML = '<option value="">Selecciona un perfil</option>';
            
            const stockItem = stock.find(s => s.id === stockId);
            if (stockItem && stockItem.profiles.length > 0) {
                stockItem.profiles.forEach(profile => {
                    const option = document.createElement('option');
                    option.value = profile;
                    option.textContent = profile;
                    profileAssignedSelect.appendChild(option);
                });
            }
        }

        function updateEditServiceOptions() {
            const editServiceTypeSelect = document.getElementById('editServiceType');
            editServiceTypeSelect.innerHTML = '<option value="">Selecciona una cuenta</option>';
            
            stock.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.accountName || item.service} (${item.quantity} disponibles)`;
                editServiceTypeSelect.appendChild(option);
            });
        }

        function updateEditProfileOptions(stockId) {
            const editProfileAssignedSelect = document.getElementById('editProfileAssigned');
            editProfileAssignedSelect.innerHTML = '<option value="">Selecciona un perfil</option>';
            
            const stockItem = stock.find(s => s.id === stockId);
            if (stockItem && stockItem.profiles.length > 0) {
                stockItem.profiles.forEach(profile => {
                    const option = document.createElement('option');
                    option.value = profile;
                    option.textContent = profile;
                    editProfileAssignedSelect.appendChild(option);
                });
            }
        }

        // Funciones del Modal de Edición
        function openEditStockModal(stockId) {
            const stockItem = stock.find(s => s.id === stockId);
            if (!stockItem) {
                showMessage('Cuenta no encontrada', 'error');
                return;
            }

            currentEditingStock = stockItem;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('editStockId').value = stockItem.id;
            document.getElementById('editServiceName').value = stockItem.service;
            document.getElementById('editAccountName').value = stockItem.accountName || stockItem.service;
            document.getElementById('editStockQuantity').value = stockItem.quantity;
            document.getElementById('editTotalCapacity').value = stockItem.total;
            document.getElementById('editAccountEmail').value = stockItem.email;
            document.getElementById('editAccountPassword').value = stockItem.password;
            document.getElementById('editProfilesAvailable').value = stockItem.profiles.join(', ');
            document.getElementById('editServicePrice').value = stockItem.price;
            
            editStockModal.style.display = 'flex';
        }

        function closeEditStockModal() {
            editStockModal.style.display = 'none';
            currentEditingStock = null;
            editStockForm.reset();
        }

        function openEditClientModal(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) {
                showMessage('Cliente no encontrada', 'error');
                return;
            }

            currentEditingClient = client;
            
            // Actualizar opciones de servicios
            updateEditServiceOptions();
            
            // Llenar el formulario con los datos actuales
            document.getElementById('editClientId').value = client.id;
            document.getElementById('editClientName').value = client.name;
            document.getElementById('editClientPhone').value = getPhoneWithoutPrefix(client.phone);
            document.getElementById('editPurchaseDate').value = client.purchaseDate;
            document.getElementById('editPaymentDeadline').value = client.paymentDeadline;
            document.getElementById('editLoginDetails').value = client.loginDetails;
            document.getElementById('editPaymentStatus').value = client.status;
            document.getElementById('editClientNotes').value = client.notes || '';
            
            // Establecer la cuenta de servicio y perfil actual
            setTimeout(() => {
                if (client.stockId) {
                    document.getElementById('editServiceType').value = client.stockId;
                    updateEditProfileOptions(client.stockId);
                    
                    // Establecer el perfil actual después de cargar las opciones
                    setTimeout(() => {
                        document.getElementById('editProfileAssigned').value = client.profile;
                    }, 100);
                }
            }, 100);
            
            editClientModal.style.display = 'flex';
        }

        function closeEditClientModal() {
            editClientModal.style.display = 'none';
            currentEditingClient = null;
            editClientForm.reset();
        }

        // Funciones de Respaldo
        function exportAllData() {
            const data = {
                clients: clients,
                stock: stock,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const content = JSON.stringify(data, null, 2);
            const filename = `harods_tech_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Datos exportados exitosamente');
            playSound('successSound');
        }
function initMobileMenu() {
    // Event listener para el botón del menú móvil
    mobileMenuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleMobileMenu();
    });

    // Event listeners para las pestañas móviles
    mobileTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            switchTab(tabId);
            closeMobileMenu();
        });
    });

    // Cerrar menú al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (isMobileMenuOpen && 
            !mobileTabsContainer.contains(e.target) && 
            !mobileMenuBtn.contains(e.target)) {
            closeMobileMenu();
        }
    });

    // Cerrar menú con tecla Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && isMobileMenuOpen) {
            closeMobileMenu();
        }
    });

    // Manejar cambios de tamaño de ventana
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768 && isMobileMenuOpen) {
            closeMobileMenu();
        }
    });
}

// Función para alternar el menú móvil
function toggleMobileMenu() {
    if (isMobileMenuOpen) {
        closeMobileMenu();
    } else {
        openMobileMenu();
    }
}

// Función para abrir el menú móvil
function openMobileMenu() {
    mobileTabsContainer.classList.add('show');
    mobileTabsContainer.style.display = 'flex';
    isMobileMenuOpen = true;
    
    // Animación de entrada
    mobileTabsContainer.style.opacity = '0';
    mobileTabsContainer.style.transform = 'translateY(-10px)';
    
    setTimeout(() => {
        mobileTabsContainer.style.opacity = '1';
        mobileTabsContainer.style.transform = 'translateY(0)';
        mobileTabsContainer.style.transition = 'all 0.3s ease-out';
    }, 10);

    // Cambiar ícono a "X"
    mobileMenuBtn.innerHTML = '<i class="fas fa-times"></i>';
    
    // Agregar clase activa al botón
    mobileMenuBtn.classList.add('active');
    
    // Deshabilitar scroll del body
    document.body.style.overflow = 'hidden';
    
    // Enfocar el primer elemento del menú para accesibilidad
    setTimeout(() => {
        const firstTab = mobileTabsContainer.querySelector('.mobile-tab');
        if (firstTab) {
            firstTab.focus();
        }
    }, 300);
}

// Función para cerrar el menú móvil
function closeMobileMenu() {
    // Animación de salida
    mobileTabsContainer.style.opacity = '0';
    mobileTabsContainer.style.transform = 'translateY(-10px)';
    
    setTimeout(() => {
        mobileTabsContainer.classList.remove('show');
        mobileTabsContainer.style.display = 'none';
        mobileTabsContainer.style.opacity = '';
        mobileTabsContainer.style.transform = '';
        mobileTabsContainer.style.transition = '';
        isMobileMenuOpen = false;
    }, 300);

    // Cambiar ícono a hamburguesa
    mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
    
    // Remover clase activa del botón
    mobileMenuBtn.classList.remove('active');
    
    // Restaurar scroll del body
    document.body.style.overflow = '';
    
    // Enfocar el botón del menú para accesibilidad
    mobileMenuBtn.focus();
}

// Función para actualizar la pestaña activa en el menú móvil
function updateMobileActiveTab(tabId) {
    mobileTabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('data-tab') === tabId) {
            tab.classList.add('active');
        }
    });
}

// Función mejorada para cambiar pestañas
function switchTab(tabId) {
    // Ocultar todas las pestañas
    tabs.forEach(t => t.classList.remove('active'));
    mobileTabs.forEach(t => t.classList.remove('active'));
    tabContents.forEach(tc => tc.classList.remove('active'));
    
    // Activar pestaña seleccionada
    const selectedTab = document.querySelector(`[data-tab="${tabId}"]`);
    const selectedContent = document.getElementById(tabId + 'Tab');
    
    if (selectedTab && selectedContent) {
        selectedTab.classList.add('active');
        selectedContent.classList.add('active');
        
        // Actualizar pestaña activa en móvil
        updateMobileActiveTab(tabId);
        
        // Cargar contenido específico si es necesario
        if (tabId === 'backup') {
            renderFileList();
        }
        
        // Scroll suave al contenido en móvil
        if (window.innerWidth <= 768) {
            setTimeout(() => {
                selectedContent.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        }
        
        // Reproducir sonido de clic
        playSound('clickSound');
    }
}

// Inicialización del menú móvil cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    initMobileMenu();
    
    // Asegurar que el menú esté cerrado al cargar la página
    closeMobileMenu();
    
    // Event listeners para las pestañas de escritorio
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            switchTab(tabId);
        });
    });
});

// Manejar el estado de autenticación para el menú móvil
function handleMobileAuthState(isLoggedIn) {
    if (isLoggedIn) {
        // Usuario autenticado - asegurar que el menú esté disponible
        mobileMenuBtn.style.display = 'flex';
        if (window.innerWidth <= 768) {
            mobileTabsContainer.style.display = 'none';
        }
    } else {
        // Usuario no autenticado - ocultar menú móvil
        mobileMenuBtn.style.display = 'none';
        mobileTabsContainer.style.display = 'none';
        closeMobileMenu();
    }
}

// Función para manejar cambios de orientación en móviles
function handleOrientationChange() {
    if (window.innerWidth <= 768 && isMobileMenuOpen) {
        // Ajustar el menú cuando cambia la orientación
        setTimeout(() => {
            if (window.innerHeight < window.innerWidth) {
                // Landscape - limitar altura del menú
                mobileTabsContainer.style.maxHeight = '60vh';
                mobileTabsContainer.style.overflowY = 'auto';
            } else {
                // Portrait - altura automática
                mobileTabsContainer.style.maxHeight = '';
                mobileTabsContainer.style.overflowY = '';
            }
        }, 100);
    }
}

// Event listener para cambios de orientación
window.addEventListener('orientationchange', handleOrientationChange);
window.addEventListener('resize', handleOrientationChange);

// Mejoras de accesibilidad para el menú móvil
function enhanceMobileAccessibility() {
    // Navegación con teclado en el menú móvil
    mobileTabsContainer.addEventListener('keydown', function(e) {
        const tabsArray = Array.from(mobileTabs);
        const currentIndex = tabsArray.indexOf(document.activeElement);
        
        switch(e.key) {
            case 'ArrowDown':
            case 'ArrowRight':
                e.preventDefault();
                const nextIndex = (currentIndex + 1) % tabsArray.length;
                tabsArray[nextIndex].focus();
                break;
                
            case 'ArrowUp':
            case 'ArrowLeft':
                e.preventDefault();
                const prevIndex = (currentIndex - 1 + tabsArray.length) % tabsArray.length;
                tabsArray[prevIndex].focus();
                break;
                
            case 'Home':
                e.preventDefault();
                tabsArray[0].focus();
                break;
                
            case 'End':
                e.preventDefault();
                tabsArray[tabsArray.length - 1].focus();
                break;
                
            case 'Enter':
            case ' ':
                e.preventDefault();
                document.activeElement.click();
                break;
        }
    });
    
    // ARIA attributes para mejor accesibilidad
    mobileMenuBtn.setAttribute('aria-label', 'Menú de navegación');
    mobileMenuBtn.setAttribute('aria-expanded', 'false');
    mobileMenuBtn.setAttribute('aria-controls', 'mobileTabs');
    
    mobileTabsContainer.setAttribute('aria-label', 'Navegación móvil');
    mobileTabsContainer.setAttribute('role', 'menu');
    
    mobileTabs.forEach((tab, index) => {
        tab.setAttribute('role', 'menuitem');
        tab.setAttribute('tabindex', '-1');
        tab.setAttribute('aria-label', `Ir a ${tab.textContent}`);
    });
}

// Actualizar atributos ARIA cuando el menú se abre/cierra
function updateAriaAttributes(isOpen) {
    mobileMenuBtn.setAttribute('aria-expanded', isOpen.toString());
    
    if (isOpen) {
        mobileTabsContainer.setAttribute('aria-hidden', 'false');
        mobileTabs.forEach(tab => {
            tab.setAttribute('tabindex', '0');
        });
    } else {
        mobileTabsContainer.setAttribute('aria-hidden', 'true');
        mobileTabs.forEach(tab => {
            tab.setAttribute('tabindex', '-1');
        });
    }
}

// Modificar las funciones openMobileMenu y closeMobileMenu para incluir ARIA
function openMobileMenu() {
    mobileTabsContainer.classList.add('show');
    mobileTabsContainer.style.display = 'flex';
    isMobileMenuOpen = true;
    
    // Animación
    mobileTabsContainer.style.opacity = '0';
    mobileTabsContainer.style.transform = 'translateY(-10px)';
    
    setTimeout(() => {
        mobileTabsContainer.style.opacity = '1';
        mobileTabsContainer.style.transform = 'translateY(0)';
        mobileTabsContainer.style.transition = 'all 0.3s ease-out';
    }, 10);

    mobileMenuBtn.innerHTML = '<i class="fas fa-times"></i>';
    mobileMenuBtn.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Actualizar ARIA
    updateAriaAttributes(true);
    
    setTimeout(() => {
        const firstTab = mobileTabsContainer.querySelector('.mobile-tab');
        if (firstTab) {
            firstTab.focus();
        }
    }, 300);
}

function closeMobileMenu() {
    mobileTabsContainer.style.opacity = '0';
    mobileTabsContainer.style.transform = 'translateY(-10px)';
    
    setTimeout(() => {
        mobileTabsContainer.classList.remove('show');
        mobileTabsContainer.style.display = 'none';
        mobileTabsContainer.style.opacity = '';
        mobileTabsContainer.style.transform = '';
        mobileTabsContainer.style.transition = '';
        isMobileMenuOpen = false;
    }, 300);

    mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
    mobileMenuBtn.classList.remove('active');
    document.body.style.overflow = '';
    
    // Actualizar ARIA
    updateAriaAttributes(false);
    
    mobileMenuBtn.focus();
}

// Inicializar mejoras de accesibilidad
document.addEventListener('DOMContentLoaded', function() {
    initMobileMenu();
    enhanceMobileAccessibility();
    closeMobileMenu();
});
        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.clients && data.stock) {
                        clients = data.clients;
                        stock = data.stock;
                        
                        saveClients();
                        saveStock();
                        
                        loadClients();
                        loadStock();
                        
                        showMessage('Datos importados exitosamente');
                        playSound('successSound');
                    } else {
                        showMessage('Archivo de respaldo inválido', 'error');
                        playSound('errorSound');
                    }
                } catch (error) {
                    showMessage('Error importando datos: ' + error.message, 'error');
                    playSound('errorSound');
                }
            };
            reader.readAsText(file);
        }

        function backupClients() {
            const content = JSON.stringify(clients, null, 2);
            const filename = `clientes_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Clientes respaldados exitosamente');
            playSound('successSound');
        }

        function backupStock() {
            const content = JSON.stringify(stock, null, 2);
            const filename = `stock_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Stock respaldado exitosamente');
            playSound('successSound');
        }

        function renderFileList() {
            const files = FileSystem.listFiles();
            fileList.innerHTML = '';
            
            if (files.length === 0) {
                fileList.innerHTML = '<div class="client-item">No hay archivos de datos</div>';
                return;
            }
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'client-item';
                fileItem.innerHTML = `
                    <div class="client-info">
                        <div class="client-name">${file.name}</div>
                        <div class="client-details">
                            <div><strong>Fecha:</strong> ${new Date(file.timestamp).toLocaleString()}</div>
                            <div><strong>Tamaño:</strong> ${file.size} bytes</div>
                        </div>
                    </div>
                    <div class="client-actions">
                        <button class="btn btn-primary" onclick="downloadFile('${file.name}')">
                            <i class="fas fa-download"></i> Descargar
                        </button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function downloadFile(filename) {
            const content = localStorage.getItem(filename);
            if (content) {
                FileSystem.downloadFile(filename, content, 'application/json');
                playSound('successSound');
            }
        }

        // Funciones de búsqueda
        function searchClients(term) {
            if (!term) {
                clients = [...originalClients];
            } else {
                clients = originalClients.filter(client => 
                    client.name.toLowerCase().includes(term) || 
                    client.phone.includes(term) ||
                    (client.accountName && client.accountName.toLowerCase().includes(term)) ||
                    client.service.toLowerCase().includes(term)
                );
            }
            renderClients();
        }

        function searchStock(term) {
            if (!term) {
                stock = [...originalStock];
            } else {
                stock = originalStock.filter(item => 
                    (item.accountName && item.accountName.toLowerCase().includes(term)) ||
                    item.service.toLowerCase().includes(term) ||
                    item.email.toLowerCase().includes(term)
                );
            }
            renderStock();
        }

        // Manejadores de Eventos
        async function handleSendReminder(clientId) {
            try {
                const client = clients.find(c => c.id === clientId);
                const message = `Hola ${client.name}, este es un recordatorio de que tu pago para ${client.service} vence el ${formatDate(client.paymentDeadline)}. - Harod's Tech`;
                const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
                showMessage('Recordatorio enviado por WhatsApp');
                playSound('successSound');
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

       async function handleMarkAsPaid(clientId) {
    try {
        // Solo actualizar el estado a 'paid', mantener los demás datos intactos
        const client = clients.find(c => c.id === clientId);
        if (!client) {
            throw new Error('Cliente no encontrado');
        }
        
        await updateClient(clientId, { 
            ...client, // Mantener todos los datos existentes
            status: 'paid' // Solo cambiar el estado
        });
        
        const message = `Hola ${client.name}, hemos registrado tu pago para ${client.service}. ¡Gracias! - Harod's Tech`;
        const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
        
    } catch (error) {
        showMessage(error.message, 'error');
        playSound('errorSound');
    }
}

        async function handleCancelSubscription(clientId) {
            const client = clients.find(c => c.id === clientId);
            
            if (!confirm(`¿Estás seguro de cancelar la suscripción de ${client.name}?`)) {
                return;
            }
            
            try {
                // Liberar el perfil en el stock
                await releaseProfile(client.stockId, client.profile);
                
                // Eliminar el cliente
                await deleteClient(clientId);
                
                const message = `Hola ${client.name}, tu suscripción para ${client.service} ha sido cancelada. - Harod's Tech`;
                const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleAssignProfile(stockId, profileName) {
            try {
                await assignProfile(stockId, profileName);
                
                // Cambiar a la pestaña de agregar cliente
                switchTab('addClient');
                
                // Rellenar automáticamente la cuenta y perfil
                const stockItem = stock.find(s => s.id === stockId);
                if (stockItem) {
                    document.getElementById('serviceType').value = stockId;
                    updateProfileOptions(stockId);
                    document.getElementById('profileAssigned').value = profileName;
                    
                    // Llenar automáticamente los detalles de acceso
                    document.getElementById('loginDetails').value = `Email: ${stockItem.email}\nContraseña: ${stockItem.password}`;
                }
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleEditStock(stockId) {
            openEditStockModal(stockId);
        }

        async function handleEditClient(clientId) {
            openEditClientModal(clientId);
        }

        async function handleDeleteStock(stockId) {
            const stockItem = stock.find(s => s.id === stockId);
            if (!stockItem) return;
            
            if (!confirm(`¿Estás seguro de eliminar la cuenta ${stockItem.accountName || stockItem.service}?`)) {
                return;
            }
            
            try {
                await deleteStock(stockId);
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        // Función para cambiar pestañas
        function switchTab(tabId) {
            tabs.forEach(t => t.classList.remove('active'));
            mobileTabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(tc => tc.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            if (tabId === 'backup') {
                renderFileList();
            }
            
            // Ocultar menú móvil después de seleccionar una pestaña
            if (window.innerWidth <= 768) {
                mobileTabsContainer.style.display = 'none';
            }
        }

        // Funciones para las nuevas mejoras
        function initThemeSelector() {
            const themes = {
                'default': { 
                    primary: '#2c3e50', 
                    secondary: '#3498db',
                    dark: '#34495e',
                    light: '#ecf0f1'
                },
                'dark': { 
                    primary: '#1a1a1a', 
                    secondary: '#9b59b6',
                    dark: '#ecf0f1',
                    light: '#2c3e50'
                },
                'green': { 
                    primary: '#27ae60', 
                    secondary: '#2ecc71',
                    dark: '#34495e',
                    light: '#ecf0f1'
                },
                'purple': { 
                    primary: '#8e44ad', 
                    secondary: '#9b59b6',
                    dark: '#34495e',
                    light: '#ecf0f1'
                }
            };

            const themeBtns = document.querySelectorAll('.theme-option');
            themeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    applyTheme(themes[theme]);
                    themeOptions.style.display = 'none';
                });
            });
            
            // Aplicar tema guardado si existe
            const savedTheme = localStorage.getItem('harods_tech_theme');
            if (savedTheme && themes[savedTheme]) {
                applyTheme(themes[savedTheme]);
            }
        }

        function applyTheme(theme) {
            document.documentElement.style.setProperty('--primary', theme.primary);
            document.documentElement.style.setProperty('--secondary', theme.secondary);
            document.documentElement.style.setProperty('--dark', theme.dark);
            document.documentElement.style.setProperty('--light', theme.light);
            
            // Guardar tema en localStorage
            localStorage.setItem('harods_tech_theme', 
                Object.keys(themes).find(key => 
                    themes[key].primary === theme.primary && 
                    themes[key].secondary === theme.secondary
                ) || 'default'
            );
        }

        function createParticles() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 100 + 50 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                animatedBg.appendChild(particle);
            }
        }
// Funciones para el widget del tiempo
async function loadWeatherData() {
    try {
        // Usamos una API gratuita para el clima
        const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=14.09&longitude=-87.22&current_weather=true&timezone=America/Tegucigalpa');
        
        if (!response.ok) {
            throw new Error('Error al cargar datos del clima');
        }
        
        const data = await response.json();
        
        if (data.current_weather) {
            const temp = Math.round(data.current_weather.temperature);
            const weatherCode = data.current_weather.weathercode;
            
            document.getElementById('temperature').textContent = `${temp}°C`;
            updateWeatherIcon(weatherCode);
        }
    } catch (error) {
        console.log('Error cargando clima:', error);
        // Datos por defecto si falla la API
        document.getElementById('temperature').textContent = '25°C';
        document.getElementById('location').textContent = 'Tegucigalpa';
    }
}

function updateWeatherIcon(weatherCode) {
    const weatherIcon = document.querySelector('.weather-widget i');
    
    // Mapeo de códigos de clima a iconos FontAwesome
    const weatherIcons = {
        0: 'fa-sun', // Despejado
        1: 'fa-sun', // Mayormente despejado
        2: 'fa-cloud-sun', // Parcialmente nublado
        3: 'fa-cloud', // Nublado
        45: 'fa-smog', // Niebla
        48: 'fa-smog', // Niebla escarchada
        51: 'fa-cloud-rain', // Llovizna ligera
        53: 'fa-cloud-rain', // Llovizna moderada
        55: 'fa-cloud-rain', // Llovizna densa
        61: 'fa-cloud-showers-heavy', // Lluvia ligera
        63: 'fa-cloud-showers-heavy', // Lluvia moderada
        65: 'fa-cloud-showers-heavy', // Lluvia fuerte
        80: 'fa-cloud-rain', // Chubascos ligeros
        81: 'fa-cloud-showers-heavy', // Chubascos moderados
        82: 'fa-cloud-showers-heavy', // Chubascos fuertes
        95: 'fa-bolt', // Tormenta ligera
        96: 'fa-bolt', // Tormenta con granizo ligero
        99: 'fa-bolt' // Tormenta con granizo fuerte
    };
    
    const iconClass = weatherIcons[weatherCode] || 'fa-sun';
    weatherIcon.className = `fas ${iconClass}`;
    
    // Actualizar color según el clima
    if ([0, 1].includes(weatherCode)) {
        weatherIcon.style.color = 'var(--warning)';
    } else if ([2, 3].includes(weatherCode)) {
        weatherIcon.style.color = 'var(--text-secondary)';
    } else {
        weatherIcon.style.color = 'var(--secondary)';
    }
}

// Función para actualizar el reloj
// Función para actualizar el reloj
// Función para actualizar el reloj
function updateClock() {
    const now = new Date();
    
    // Formatear hora
    const time = now.toLocaleTimeString('es-HN', { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit'
    });
    
    // Formatear fecha
    const date = now.toLocaleDateString('es-HN', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    // Capitalizar primera letra
    const formattedDate = date.charAt(0).toUpperCase() + date.slice(1);
    
    // Actualizar elementos en el DOM
    const timeElement = document.getElementById('currentTime');
    const dateElement = document.getElementById('currentDate');
    
    if (timeElement) timeElement.textContent = time;
    if (dateElement) dateElement.textContent = formattedDate;
}

// Función para el widget del clima
function updateWeather() {
    const now = new Date();
    const hour = now.getHours();
    
    // Temperatura basada en la hora del día (simulada para Tegucigalpa)
    let temp;
    let weatherIcon = 'fa-sun';
    let iconColor = 'var(--warning)';
    
    if (hour >= 5 && hour < 12) {
        // Mañana (6am - 12pm)
        temp = 22 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-sun';
        iconColor = 'var(--warning)';
    } else if (hour >= 12 && hour < 15) {
        // Mediodía (12pm - 3pm)
        temp = 28 + Math.floor(Math.random() * 4);
        weatherIcon = 'fa-sun';
        iconColor = 'var(--warning)';
    } else if (hour >= 15 && hour < 18) {
        // Tarde (3pm - 6pm)
        temp = 26 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-cloud-sun';
        iconColor = 'var(--text-secondary)';
    } else if (hour >= 18 && hour < 21) {
        // Atardecer (6pm - 9pm)
        temp = 24 + Math.floor(Math.random() * 2);
        weatherIcon = 'fa-cloud-moon';
        iconColor = 'var(--secondary)';
    } else {
        // Noche (9pm - 5am)
        temp = 20 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-moon';
        iconColor = 'var(--secondary)';
    }
    
    // Actualizar elementos en el DOM
    const tempElement = document.getElementById('temperature');
    const locationElement = document.getElementById('location');
    const weatherIconElement = document.querySelector('.weather-widget i');
    
    if (tempElement) tempElement.textContent = `${temp}°C`;
    if (locationElement) locationElement.textContent = 'Tegucigalpa';
    if (weatherIconElement) {
        weatherIconElement.className = `fas ${weatherIcon}`;
        weatherIconElement.style.color = iconColor;
    }
}

// Función para inicializar todos los widgets
function initWidgets() {
    console.log('Inicializando widgets...');
    
    // Actualizar inmediatamente
    updateClock();
    updateWeather();
    
    // Actualizar reloj cada segundo
    setInterval(updateClock, 1000);
    
    // Actualizar clima cada 5 minutos
    setInterval(updateWeather, 5 * 60 * 1000);
    
    console.log('Widgets inicializados correctamente');
}

// Verificar si los elementos existen antes de inicializar
function checkWidgetElements() {
    const timeElement = document.getElementById('currentTime');
    const weatherElement = document.getElementById('temperature');
    
    if (!timeElement || !weatherElement) {
        console.log('Elementos de widgets no encontrados, reintentando...');
        setTimeout(checkWidgetElements, 1000);
        return;
    }
    
    console.log('Elementos de widgets encontrados, iniciando...');
    initWidgets();
}

// Función para el widget del clima
function updateWeather() {
    const now = new Date();
    const hour = now.getHours();
    
    // Temperatura basada en la hora del día (simulada para Tegucigalpa)
    let temp;
    let weatherIcon = 'fa-sun';
    let iconColor = 'var(--warning)';
    
    if (hour >= 5 && hour < 12) {
        // Mañana (6am - 12pm)
        temp = 22 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-sun';
        iconColor = 'var(--warning)';
    } else if (hour >= 12 && hour < 15) {
        // Mediodía (12pm - 3pm)
        temp = 28 + Math.floor(Math.random() * 4);
        weatherIcon = 'fa-sun';
        iconColor = 'var(--warning)';
    } else if (hour >= 15 && hour < 18) {
        // Tarde (3pm - 6pm)
        temp = 26 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-cloud-sun';
        iconColor = 'var(--text-secondary)';
    } else if (hour >= 18 && hour < 21) {
        // Atardecer (6pm - 9pm)
        temp = 24 + Math.floor(Math.random() * 2);
        weatherIcon = 'fa-cloud-moon';
        iconColor = 'var(--secondary)';
    } else {
        // Noche (9pm - 5am)
        temp = 20 + Math.floor(Math.random() * 3);
        weatherIcon = 'fa-moon';
        iconColor = 'var(--secondary)';
    }
    
    // Actualizar elementos en el DOM
    const tempElement = document.getElementById('temperature');
    const locationElement = document.getElementById('location');
    const weatherIconElement = document.querySelector('.weather-widget i');
    
    if (tempElement) tempElement.textContent = `${temp}°C`;
    if (locationElement) locationElement.textContent = 'Tegucigalpa';
    if (weatherIconElement) {
        weatherIconElement.className = `fas ${weatherIcon}`;
        weatherIconElement.style.color = iconColor;
    }
}

// Función para inicializar todos los widgets
function initWidgets() {
    console.log('Inicializando widgets...');
    
    // Actualizar inmediatamente
    updateClock();
    updateWeather();
    
    // Actualizar reloj cada segundo
    setInterval(updateClock, 1000);
    
    // Actualizar clima cada 5 minutos
    setInterval(updateWeather, 5 * 60 * 1000);
    
    console.log('Widgets inicializados correctamente');
}

// Verificar si los elementos existen antes de inicializar
function checkWidgetElements() {
    const timeElement = document.getElementById('currentTime');
    const weatherElement = document.getElementById('temperature');
    
    if (!timeElement || !weatherElement) {
        console.log('Elementos de widgets no encontrados, reintentando...');
        setTimeout(checkWidgetElements, 1000);
        return;
    }
    
    console.log('Elementos de widgets encontrados, iniciando...');
    initWidgets();
}

// Inicializar widgets
function initWidgets() {
    // Cargar clima inmediatamente
    loadWeatherData();
    
    // Actualizar reloj inmediatamente y cada segundo
    updateClock();
    setInterval(updateClock, 1000);
    
    // Actualizar clima cada 30 minutos
    setInterval(loadWeatherData, 30 * 60 * 1000);
}

// Versión alternativa por si la API falla (usando datos estáticos)
function loadFallbackWeather() {
    const now = new Date();
    const hour = now.getHours();
    
    // Simular temperatura basada en la hora
    let temp;
    if (hour >= 6 && hour < 12) {
        temp = 22; // Mañana
    } else if (hour >= 12 && hour < 18) {
        temp = 28; // Tarde
    } else if (hour >= 18 && hour < 22) {
        temp = 24; // Noche temprana
    } else {
        temp = 20; // Noche tarde
    }
    
    // Simular condiciones climáticas basadas en la hora
    const weatherIcon = document.querySelector('.weather-widget i');
    if (hour >= 6 && hour < 18) {
        // Día
        if (Math.random() > 0.3) {
            weatherIcon.className = 'fas fa-sun';
            weatherIcon.style.color = 'var(--warning)';
        } else {
            weatherIcon.className = 'fas fa-cloud-sun';
            weatherIcon.style.color = 'var(--text-secondary)';
        }
    } else {
        // Noche
        weatherIcon.className = 'fas fa-moon';
        weatherIcon.style.color = 'var(--secondary)';
    }
    
    document.getElementById('temperature').textContent = `${temp}°C`;
    document.getElementById('location').textContent = 'Tegucigalpa';
}
        function updateClock() {
            const now = new Date();
            currentTimeElement.textContent = now.toLocaleTimeString('es-HN');
            currentDateElement.textContent = now.toLocaleDateString('es-HN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function updateStats() {
            totalClientsElement.textContent = clients.length;
            totalStockElement.textContent = stock.length;
            pendingPaymentsElement.textContent = clients.filter(c => c.status === 'pending').length;
        }

        // Sistema de música corregido
        function initMusicPlayer() {
            // Configurar volumen inicial
            backgroundMusic.volume = volumeSlider.value;

            // Manejar el control de volumen
            volumeSlider.addEventListener('input', function() {
                backgroundMusic.volume = this.value;
            });

            // Manejar el botón de música
            musicToggle.addEventListener('click', function() {
                if (isMusicPlaying) {
                    pauseBackgroundMusic();
                } else {
                    playBackgroundMusic();
                }
            });

            // Manejar errores de audio
            backgroundMusic.addEventListener('error', function(e) {
                console.error('Error de audio:', e);
                showMessage('Error cargando la música', 'error');
                updateMusicUI(false);
            });

            // Actualizar UI cuando la música termina
            backgroundMusic.addEventListener('ended', function() {
                // Reiniciar y reproducir de nuevo cuando termine (loop)
                backgroundMusic.currentTime = 0;
                if (isMusicPlaying) {
                    playBackgroundMusic();
                }
            });
        }

        function playBackgroundMusic() {
            backgroundMusic.play().then(() => {
                isMusicPlaying = true;
                updateMusicUI(true);
                showMessage('Música activada');
            }).catch(error => {
                // Error en reproducción
                console.error('Error reproduciendo música:', error);
                isMusicPlaying = false;
                updateMusicUI(false);
                
                if (error.name === 'NotAllowedError') {
                    showMessage('Haz clic en la página primero para permitir la música', 'warning');
                } else {
                    showMessage('Error al reproducir música: ' + error.message, 'error');
                }
            });
        }

        function pauseBackgroundMusic() {
            backgroundMusic.pause();
            isMusicPlaying = false;
            updateMusicUI(false);
            showMessage('Música pausada');
        }

        function updateMusicUI(isPlaying) {
            if (isPlaying) {
                musicStatus.textContent = 'Música ON';
                musicIcon.className = 'fas fa-pause';
                musicToggle.style.background = 'rgba(46, 204, 113, 0.3)';
            } else {
                musicStatus.textContent = 'Música OFF';
                musicIcon.className = 'fas fa-play';
                musicToggle.style.background = 'transparent';
            }
        }

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            if (sound) {
                // Reiniciar el audio
                sound.currentTime = 0;
                
                // Reproducir con manejo de errores
                const playPromise = sound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('Error reproduciendo sonido:', error);
                    });
                }
            }
        }

        function initDarkMode() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
            
            if (prefersDark.matches && !localStorage.getItem('harods_tech_theme')) {
                applyTheme({
                    primary: '#1a1a1a',
                    secondary: '#9b59b6',
                    dark: '#ecf0f1',
                    light: '#2c3e50'
                });
            }
            
            prefersDark.addListener((e) => {
                if (e.matches && !localStorage.getItem('harods_tech_theme')) {
                    applyTheme({
                        primary: '#1a1a1a',
                        secondary: '#9b59b6',
                        dark: '#ecf0f1',
                        light: '#2c3e50'
                    });
                }
            });
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay sesión activa
            if (SessionManager.isLoggedIn()) {
                loginSection.style.display = 'none';
                dashboard.style.display = 'block';
                showMessage('Sesión recuperada correctamente');
            } else {
                loginSection.style.display = 'block';
                dashboard.style.display = 'none';
            }

            // Establecer fechas por defecto
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthFormatted = nextMonth.toISOString().split('T')[0];
            
            document.getElementById('purchaseDate').value = today;
            document.getElementById('paymentDeadline').value = nextMonthFormatted;
            
            // Cargar datos iniciales
            loadClients();
            loadStock();
            renderFileList();
            
            // Inicializar nuevas funcionalidades
            initThemeSelector();
            createParticles();
            setInterval(updateClock, 1000);
            updateClock();
            setInterval(updateStats, 5000);
            initMusicPlayer();
            initDarkMode();
            initWidgets();
            // Agregar efectos de sonido a botones importantes
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => playSound('clickSound'));
            });
            
            // Inicializar menú móvil
            mobileMenuBtn.addEventListener('click', function() {
                if (mobileTabsContainer.style.display === 'flex') {
                    mobileTabsContainer.style.display = 'none';
                } else {
                    mobileTabsContainer.style.display = 'flex';
                }
            });
        });
setTimeout(() => {
        checkWidgetElements();
    }, 500);
        // Event Listeners
        loginBtn.addEventListener('click', function() {
            if (passwordInput.value === ACCESS_PASSWORD) {
                SessionManager.login();
                loginSection.style.display = 'none';
                dashboard.style.display = 'block';
                showMessage('Sesión iniciada correctamente');
                playSound('successSound');
            } else {
                showMessage('Contraseña incorrecta. Solo el propietario puede acceder.', 'error');
                playSound('errorSound');
                passwordInput.value = '';
            }
        });

        logoutBtn.addEventListener('click', function() {
            SessionManager.logout();
            dashboard.style.display = 'none';
            loginSection.style.display = 'block';
            passwordInput.value = '';
            showMessage('Sesión cerrada correctamente');
            playSound('successSound');
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        mobileTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        themeBtn.addEventListener('click', function() {
            if (themeOptions.style.display === 'block') {
                themeOptions.style.display = 'none';
            } else {
                themeOptions.style.display = 'block';
            }
        });

        // Cerrar selector de temas al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!themeBtn.contains(e.target) && !themeOptions.contains(e.target)) {
                themeOptions.style.display = 'none';
            }
        });

        addClientForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockId = document.getElementById('serviceType').value;
            const stockItem = stock.find(s => s.id === stockId);
            
            if (!stockItem) {
                showMessage('Por favor selecciona una cuenta válida', 'error');
                playSound('errorSound');
                return;
            }
            
            const clientData = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                service: stockItem.service,
                accountName: stockItem.accountName || stockItem.service,
                profile: document.getElementById('profileAssigned').value,
                stockId: stockId,
                purchaseDate: document.getElementById('purchaseDate').value,
                paymentDeadline: document.getElementById('paymentDeadline').value,
                loginDetails: document.getElementById('loginDetails').value,
                status: document.getElementById('paymentStatus').value,
                notes: document.getElementById('clientNotes').value
            };
            
            try {
                await addClient(clientData);
                addClientForm.reset();
                
                // Restablecer fechas
                const today = new Date().toISOString().split('T')[0];
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                const nextMonthFormatted = nextMonth.toISOString().split('T')[0];
                
                document.getElementById('purchaseDate').value = today;
                document.getElementById('paymentDeadline').value = nextMonthFormatted;
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        addStockForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockData = {
                service: document.getElementById('serviceName').value,
                accountName: document.getElementById('accountName').value,
                quantity: parseInt(document.getElementById('stockQuantity').value),
                total: parseInt(document.getElementById('totalCapacity').value),
                email: document.getElementById('accountEmail').value,
                password: document.getElementById('accountPassword').value,
                profiles: document.getElementById('profilesAvailable').value,
                price: parseFloat(document.getElementById('servicePrice').value)
            };
            
            try {
                await addStock(stockData);
                addStockForm.reset();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        // Eventos del modal de edición
        editStockForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockData = {
                service: document.getElementById('editServiceName').value,
                accountName: document.getElementById('editAccountName').value,
                quantity: parseInt(document.getElementById('editStockQuantity').value),
                total: parseInt(document.getElementById('editTotalCapacity').value),
                email: document.getElementById('editAccountEmail').value,
                password: document.getElementById('editAccountPassword').value,
                profiles: document.getElementById('editProfilesAvailable').value,
                price: parseFloat(document.getElementById('editServicePrice').value)
            };
            
            try {
                await updateStock(currentEditingStock.id, stockData);
                closeEditStockModal();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        editClientForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockId = document.getElementById('editServiceType').value;
            const stockItem = stock.find(s => s.id === stockId);
            
            if (!stockItem) {
                showMessage('Por favor selecciona una cuenta válida', 'error');
                playSound('errorSound');
                return;
            }
            
            const clientData = {
                name: document.getElementById('editClientName').value,
                phone: document.getElementById('editClientPhone').value,
                service: stockItem.service,
                accountName: stockItem.accountName || stockItem.service,
                profile: document.getElementById('editProfileAssigned').value,
                stockId: stockId,
                purchaseDate: document.getElementById('editPurchaseDate').value,
                paymentDeadline: document.getElementById('editPaymentDeadline').value,
                loginDetails: document.getElementById('editLoginDetails').value,
                status: document.getElementById('editPaymentStatus').value,
                notes: document.getElementById('editClientNotes').value
            };
            
            try {
                await updateClient(currentEditingClient.id, clientData);
                closeEditClientModal();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        closeModalBtn.forEach(btn => {
            btn.addEventListener('click', function() {
                closeEditStockModal();
                closeEditClientModal();
            });
        });

        cancelEditBtn.addEventListener('click', closeEditStockModal);
        cancelEditClientBtn.addEventListener('click', closeEditClientModal);

        // Cerrar modal al hacer clic fuera
        editStockModal.addEventListener('click', function(e) {
            if (e.target === editStockModal) {
                closeEditStockModal();
            }
        });

        editClientModal.addEventListener('click', function(e) {
            if (e.target === editClientModal) {
                closeEditClientModal();
            }
        });

        serviceTypeSelect.addEventListener('change', function() {
            updateProfileOptions(this.value);
        });

        document.getElementById('editServiceType').addEventListener('change', function() {
            updateEditProfileOptions(this.value);
        });

        refreshClientsBtn.addEventListener('click', loadClients);
        refreshStockBtn.addEventListener('click', loadStock);

        searchBtn.addEventListener('click', function() {
            const searchTerm = searchInput.value.toLowerCase();
            searchClients(searchTerm);
            
            if (searchTerm) {
                showMessage(`${clients.length} clientes encontrados`);
            }
        });

        stockSearchBtn.addEventListener('click', function() {
            const searchTerm = stockSearchInput.value.toLowerCase();
            searchStock(searchTerm);
            
            if (searchTerm) {
                showMessage(`${stock.length} cuentas encontradas`);
            }
        });

        // Búsqueda en tiempo real
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            if (searchTerm.length === 0 || searchTerm.length > 2) {
                searchClients(searchTerm);
            }
        });

        stockSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            if (searchTerm.length === 0 || searchTerm.length > 2) {
                searchStock(searchTerm);
            }
        });

        // Eventos de respaldo
        exportDataBtn.addEventListener('click', exportAllData);
        
        importDataBtn.addEventListener('click', function() {
            importFile.click();
        });
        
        importFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                importData(e.target.files[0]);
            }
        });
        
        backupClientsBtn.addEventListener('click', backupClients);
        backupStockBtn.addEventListener('click', backupStock);

        // Funciones globales para los botones
        window.handleSendReminder = handleSendReminder;
        window.handleMarkAsPaid = handleMarkAsPaid;
        window.handleCancelSubscription = handleCancelSubscription;
        window.handleAssignProfile = handleAssignProfile;
        window.handleEditStock = handleEditStock;
        window.handleEditClient = handleEditClient;
        window.handleDeleteStock = handleDeleteStock;
        window.downloadFile = downloadFile;
    </script>
</body>
</html>
