<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harod's Tech - Gestión Completa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --netflix: #e50914;
            --disney: #113ccf;
            --hbo: #9467fe;
            --prime: #00a8e1;
            --crunchyroll: #f47521;
            --spotify: #1db954;
            --light: #ecf0f1;
            --dark: #34495e;
            --transition: all 0.3s ease;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite linear;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
            overflow: hidden;
            border-right: 3px solid white;
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink 1s infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink {
            0%, 50% { border-color: transparent }
            51%, 100% { border-color: white }
        }
        
        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 3px;
            background: white;
            transition: var(--transition);
        }
        
        .logo:hover::after {
            width: 100%;
        }
        
        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* Fondo animado con partículas */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #f5f7fa, #e4e7ec);
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* Selector de temas */
        .theme-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .theme-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-hover);
        }
        
        .theme-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 10px;
            min-width: 150px;
        }
        
        .theme-option {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px 0;
            transition: var(--transition);
        }
        
        .theme-option:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        /* Widgets */
        .widgets {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .weather-widget, .clock-widget {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
        }
        
        .weather-widget i {
            font-size: 1.5rem;
            color: var(--warning);
        }
        
        .clock-widget {
            flex-direction: column;
            text-align: center;
            gap: 5px;
        }
        
        #currentTime {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        #currentDate {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        /* Tarjetas de estadísticas */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .stat-card i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        /* Reproductor de música */
        .music-player {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .login-section {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.5s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .login-section h2 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .login-section input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .login-section input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .login-section button {
            width: 100%;
            padding: 12px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .login-section button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .login-section button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .login-section button:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .dashboard {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .welcome-message {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .logout-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
            overflow-x: auto;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: bold;
        }
        
        .tab:hover:not(.active) {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition);
        }
        
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInContent 0.4s forwards;
        }
        
        @keyframes fadeInContent {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .client-form, .stock-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }
        
        .client-form:hover, .stock-form:hover {
            box-shadow: var(--shadow-hover);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        /* Efecto de neón para botones importantes */
        .btn-neon {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            text-shadow: 0 0 5px currentColor;
            box-shadow: 0 0 10px var(--secondary), inset 0 0 10px var(--secondary);
            transition: all 0.3s ease;
        }
        
        .btn-neon:hover {
            background: var(--secondary);
            color: white;
            box-shadow: 0 0 20px var(--secondary), 0 0 40px var(--secondary);
            transform: translateY(-2px);
        }
        
        .clients-list, .stock-list {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .client-item, .stock-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            transition: var(--transition);
        }
        
        .client-item:hover, .stock-item:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .client-item:last-child, .stock-item:last-child {
            border-bottom: none;
        }
        
        .client-info, .stock-info {
            flex: 1;
            min-width: 250px;
        }
        
        .client-name, .stock-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .client-details, .stock-details {
            color: #666;
            font-size: 0.9rem;
        }
        
        .client-actions, .stock-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .status-overdue {
            color: var(--danger);
            font-weight: bold;
        }
        
        .status-pending {
            color: var(--warning);
            font-weight: bold;
        }
        
        .status-paid {
            color: var(--success);
            font-weight: bold;
        }
        
        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .search-bar input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .search-bar button {
            padding: 10px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .search-bar button:hover {
            background-color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stock-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            position: relative;
            border-top: 5px solid;
            transition: var(--transition);
            transform: translateY(0);
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .stock-card.netflix {
            border-color: var(--netflix);
        }
        
        .stock-card.disney {
            border-color: var(--disney);
        }
        
        .stock-card.hbo {
            border-color: var(--hbo);
        }
        
        .stock-card.prime {
            border-color: var(--prime);
        }
        
        .stock-card.crunchyroll {
            border-color: var(--crunchyroll);
        }
        
        .stock-card.spotify {
            border-color: var(--spotify);
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stock-title {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .stock-count {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .stock-email {
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .stock-profiles {
            margin-bottom: 15px;
        }
        
        .profile-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .profile-item:last-child {
            border-bottom: none;
        }
        
        .stock-actions-card {
            display: flex;
            gap: 10px;
        }
        
        .stock-actions-card button {
            flex: 1;
        }
        
        .low-stock {
            color: var(--danger);
        }
        
        .medium-stock {
            color: var(--warning);
        }
        
        .high-stock {
            color: var(--success);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }

        .error-message {
            background-color: #fee;
            color: var(--danger);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid var(--danger);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .success-message {
            background-color: #efe;
            color: var(--success);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .backup-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .edit-stock-modal, .edit-client-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        .edit-stock-content, .edit-client-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            animation: zoomIn 0.3s forwards;
        }

        @keyframes zoomIn {
            to {
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
        }

        .mobile-tabs {
            display: none;
            flex-direction: column;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .mobile-tab {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: var(--transition);
        }

        .mobile-tab:last-child {
            border-bottom: none;
        }

        .mobile-tab.active {
            background-color: var(--secondary);
            color: white;
        }

        .mobile-tab:hover:not(.active) {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .phone-prefix {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .phone-prefix span {
            background: #f8f9fa;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            border-right: none;
            font-weight: bold;
        }

        .phone-prefix input {
            border-radius: 0 5px 5px 0;
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .client-item, .stock-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .client-actions, .stock-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .client-actions button, .stock-actions button {
                flex: 1;
                text-align: center;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .logout-btn {
                margin-top: 10px;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
                position: absolute;
                top: 20px;
                right: 20px;
            }

            .mobile-tabs {
                display: flex;
            }

            .search-bar {
                flex-direction: column;
            }

            .stock-actions-card {
                flex-direction: column;
            }

            .edit-stock-content, .edit-client-content {
                width: 95%;
                padding: 20px;
            }
            
            .widgets {
                flex-direction: column;
            }
            
            .theme-selector {
                top: 10px;
                right: 10px;
            }
            
            .music-player {
                bottom: 10px;
                left: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px 0;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .login-section {
                padding: 20px;
                margin: 20px auto;
            }
            
            .client-form, .stock-form {
                padding: 15px;
            }
            
            .client-item, .stock-item {
                padding: 10px;
            }
            
            .stock-card {
                padding: 15px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo animado con partículas -->
    <div class="animated-bg" id="animatedBg"></div>
    
    <!-- Selector de temas -->
    <div class="theme-selector">
        <button class="theme-btn" id="themeBtn">
            <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options" id="themeOptions">
            <div class="theme-option" data-theme="default">Tema Azul</div>
            <div class="theme-option" data-theme="dark">Tema Oscuro</div>
            <div class="theme-option" data-theme="green">Tema Verde</div>
            <div class="theme-option" data-theme="purple">Tema Púrpura</div>
        </div>
    </div>
    
    <!-- Reproductor de música -->
    <div class="music-player">
        <button id="musicToggle" class="btn btn-primary">
            <i class="fas fa-music"></i>
            <span>Música: OFF</span>
        </button>
        <audio id="backgroundMusic" loop>
            <!-- En un entorno real, aquí iría la fuente del archivo de música -->
        </audio>
    </div>
    
    <!-- Elementos de audio para efectos de sonido -->
    <audio id="clickSound" preload="auto">
        <!-- En un entorno real, aquí iría la fuente del archivo de sonido -->
    </audio>
    <audio id="successSound" preload="auto">
        <!-- En un entorno real, aquí iría la fuente del archivo de sonido -->
    </audio>
    <audio id="errorSound" preload="auto">
        <!-- En un entorno real, aquí iría la fuente del archivo de sonido -->
    </audio>
    
    <header>
        <div class="container">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">Harod's Tech</div>
            <div class="tagline">Gestión de Clientes y Stock</div>
        </div>
    </header>
    
    <div class="container">
        <!-- Sección de Login -->
        <div id="loginSection" class="login-section">
            <h2>Acceso Administrativo</h2>
            <p>Solo el propietario puede acceder a esta área</p>
            <input type="password" id="password" placeholder="Contraseña de acceso">
            <button id="loginBtn">Ingresar</button>
        </div>
        
        <!-- Dashboard (oculto inicialmente) -->
        <div id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <div class="welcome-message">Bienvenido a Harod's Tech</div>
                <button id="logoutBtn" class="logout-btn">Cerrar Sesión</button>
            </div>
            
            <!-- Widgets -->
            <div class="widgets">
                <div class="weather-widget">
                    <i class="fas fa-sun"></i>
                    <div>
                        <div id="temperature">--°C</div>
                        <div id="location">Tegucigalpa</div>
                    </div>
                </div>
                <div class="clock-widget">
                    <div id="currentTime">--:--:--</div>
                    <div id="currentDate">-- --- ----</div>
                </div>
            </div>
            
            <!-- Tarjetas de estadísticas -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Clientes Activos</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-boxes"></i>
                    <div class="stat-number" id="totalStock">0</div>
                    <div class="stat-label">Cuentas en Stock</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="stat-number" id="pendingPayments">0</div>
                    <div class="stat-label">Pagos Pendientes</div>
                </div>
            </div>
            
            <!-- Menú móvil -->
            <div class="mobile-tabs" id="mobileTabs">
                <div class="mobile-tab active" data-tab="clients">Lista de Clientes</div>
                <div class="mobile-tab" data-tab="addClient">Agregar Cliente</div>
                <div class="mobile-tab" data-tab="stock">Stock de Servicios</div>
                <div class="mobile-tab" data-tab="addStock">Agregar Stock</div>
                <div class="mobile-tab" data-tab="backup">Respaldo</div>
            </div>
            
            <!-- Menú de escritorio -->
            <div class="tabs">
                <div class="tab active" data-tab="clients">Lista de Clientes</div>
                <div class="tab" data-tab="addClient">Agregar Cliente</div>
                <div class="tab" data-tab="stock">Stock de Servicios</div>
                <div class="tab" data-tab="addStock">Agregar Stock</div>
                <div class="tab" data-tab="backup">Respaldo</div>
            </div>

            <!-- Mensajes de estado -->
            <div id="messageContainer"></div>
            
            <!-- Contenido de la pestaña Lista de Clientes -->
            <div id="clientsTab" class="tab-content active">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Buscar cliente...">
                    <button id="searchBtn">Buscar</button>
                    <button id="refreshClientsBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                
                <div class="clients-list" id="clientsList">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Cargando clientes...
                    </div>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Agregar Cliente -->
            <div id="addClientTab" class="tab-content">
                <div class="client-form">
                    <h3>Agregar Nuevo Cliente</h3>
                    <form id="addClientForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientName">Nombre del Cliente</label>
                                <input type="text" id="clientName" required>
                            </div>
                            <div class="form-group">
                                <label for="clientPhone">Número de Teléfono</label>
                                <div class="phone-prefix">
                                    <span>+504</span>
                                    <input type="tel" id="clientPhone" placeholder="XXXXXXXX" maxlength="8" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceType">Cuenta de Servicio</label>
                                <select id="serviceType" required>
                                    <option value="">Selecciona una cuenta</option>
                                    <!-- Las opciones se cargarán dinámicamente -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profileAssigned">Perfil Asignado</label>
                                <select id="profileAssigned" required>
                                    <option value="">Primero selecciona una cuenta</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="purchaseDate">Fecha de Compra</label>
                                <input type="date" id="purchaseDate" required>
                            </div>
                            <div class="form-group">
                                <label for="paymentDeadline">Fecha Límite de Pago</label>
                                <input type="date" id="paymentDeadline" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginDetails">Detalles de Acceso (usuario/contraseña)</label>
                            <textarea id="loginDetails" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentStatus">Estado de Pago</label>
                            <select id="paymentStatus">
                                <option value="pending">Pendiente</option>
                                <option value="paid">Pagado</option>
                                <option value="overdue">Vencido</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="clientNotes">Notas (opcional)</label>
                            <textarea id="clientNotes" rows="2" placeholder="Notas adicionales sobre el cliente..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-neon">
                            <i class="fas fa-plus"></i> Agregar Cliente
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Stock de Servicios -->
            <div id="stockTab" class="tab-content">
                <div class="search-bar">
                    <input type="text" id="stockSearchInput" placeholder="Buscar servicio...">
                    <button id="stockSearchBtn">Buscar</button>
                    <button id="refreshStockBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                
                <div class="stock-grid" id="stockGrid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Cargando stock...
                    </div>
                </div>
            </div>
            
            <!-- Contenido de la pestaña Agregar Stock -->
            <div id="addStockTab" class="tab-content">
                <div class="stock-form">
                    <h3>Agregar Nueva Cuenta</h3>
                    <form id="addStockForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceName">Servicio</label>
                                <select id="serviceName" required>
                                    <option value="">Selecciona un servicio</option>
                                    <option value="Netflix">Netflix</option>
                                    <option value="Disney+">Disney+</option>
                                    <option value="HBO Max">HBO Max</option>
                                    <option value="Prime Video">Prime Video</option>
                                    <option value="Crunchyroll">Crunchyroll</option>
                                    <option value="Spotify">Spotify</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="accountName">Nombre de la Cuenta</label>
                                <input type="text" id="accountName" placeholder="Ej: Netflix Principal, Netflix Secundario" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="stockQuantity">Cupos Disponibles</label>
                                <input type="number" id="stockQuantity" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="totalCapacity">Capacidad Total</label>
                                <input type="number" id="totalCapacity" min="1" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="servicePrice">Precio del Servicio ($)</label>
                                <input type="number" id="servicePrice" min="0" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="accountEmail">Correo de la Cuenta</label>
                            <input type="email" id="accountEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="accountPassword">Contraseña de la Cuenta</label>
                            <input type="text" id="accountPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="profilesAvailable">Perfiles Disponibles (separados por coma)</label>
                            <input type="text" id="profilesAvailable" placeholder="Ej: Perfil 1, Perfil 2, Perfil 3" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-neon">
                            <i class="fas fa-plus"></i> Agregar Cuenta
                        </button>
                    </form>
                </div>
            </div>

            <!-- Contenido de la pestaña Respaldo -->
            <div id="backupTab" class="tab-content">
                <div class="backup-section">
                    <h3>Respaldo de Datos</h3>
                    <p>Gestiona tus archivos de datos y realiza respaldos.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <button id="exportDataBtn" class="btn btn-success">
                                <i class="fas fa-download"></i> Exportar Todos los Datos
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="importDataBtn" class="btn btn-warning">
                                <i class="fas fa-upload"></i> Importar Datos
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <button id="backupClientsBtn" class="btn btn-primary">
                                <i class="fas fa-file-export"></i> Respaldar Clientes
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="backupStockBtn" class="btn btn-primary">
                                <i class="fas fa-file-export"></i> Respaldar Stock
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <h4>Archivos de Datos</h4>
                        <div id="fileList">
                            <div class="loading">Cargando archivos...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar stock -->
    <div id="editStockModal" class="edit-stock-modal">
        <div class="edit-stock-content">
            <div class="modal-header">
                <h3>Editar Cuenta</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editStockForm">
                <input type="hidden" id="editStockId">
                <div class="form-group">
                    <label for="editServiceName">Servicio</label>
                    <input type="text" id="editServiceName" readonly>
                </div>
                <div class="form-group">
                    <label for="editAccountName">Nombre de la Cuenta</label>
                    <input type="text" id="editAccountName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editStockQuantity">Cupos Disponibles</label>
                        <input type="number" id="editStockQuantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="editTotalCapacity">Capacidad Total</label>
                        <input type="number" id="editTotalCapacity" min="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editAccountEmail">Correo de la Cuenta</label>
                    <input type="email" id="editAccountEmail" required>
                </div>
                <div class="form-group">
                    <label for="editAccountPassword">Contraseña de la Cuenta</label>
                    <input type="text" id="editAccountPassword" required>
                </div>
                <div class="form-group">
                    <label for="editProfilesAvailable">Perfiles Disponibles (separados por coma)</label>
                    <input type="text" id="editProfilesAvailable" required>
                </div>
                <div class="form-group">
                    <label for="editServicePrice">Precio del Servicio ($)</label>
                    <input type="number" id="editServicePrice" min="0" step="0.01" required>
                </div>
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn btn-danger" id="cancelEditBtn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para editar cliente -->
    <div id="editClientModal" class="edit-client-modal">
        <div class="edit-client-content">
            <div class="modal-header">
                <h3>Editar Cliente</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editClientForm">
                <input type="hidden" id="editClientId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editClientName">Nombre del Cliente</label>
                        <input type="text" id="editClientName" required>
                    </div>
                    <div class="form-group">
                        <label for="editClientPhone">Número de Teléfono</label>
                        <div class="phone-prefix">
                            <span>+504</span>
                            <input type="tel" id="editClientPhone" placeholder="XXXXXXXX" maxlength="8" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editServiceType">Cuenta de Servicio</label>
                        <select id="editServiceType" required>
                            <option value="">Selecciona una cuenta</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editProfileAssigned">Perfil Asignado</label>
                        <select id="editProfileAssigned" required>
                            <option value="">Primero selecciona una cuenta</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editPurchaseDate">Fecha de Compra</label>
                        <input type="date" id="editPurchaseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editPaymentDeadline">Fecha Límite de Pago</label>
                        <input type="date" id="editPaymentDeadline" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editLoginDetails">Detalles de Acceso (usuario/contraseña)</label>
                    <textarea id="editLoginDetails" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editPaymentStatus">Estado de Pago</label>
                    <select id="editPaymentStatus">
                        <option value="pending">Pendiente</option>
                        <option value="paid">Pagado</option>
                        <option value="overdue">Vencido</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editClientNotes">Notas (opcional)</label>
                    <textarea id="editClientNotes" rows="2" placeholder="Notas adicionales sobre el cliente..."></textarea>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn btn-danger" id="cancelEditClientBtn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuración
        const ACCESS_PASSWORD = "HarodTech2023";
        const SESSION_KEY = "harods_tech_session";
        const DATA_FILES = {
            clients: 'harods_tech_clientes',
            stock: 'harods_tech_stock'
        };

        // Elementos del DOM
        const loginSection = document.getElementById('loginSection');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const passwordInput = document.getElementById('password');
        const tabs = document.querySelectorAll('.tab');
        const mobileTabs = document.querySelectorAll('.mobile-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const clientsList = document.getElementById('clientsList');
        const addClientForm = document.getElementById('addClientForm');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const stockGrid = document.getElementById('stockGrid');
        const addStockForm = document.getElementById('addStockForm');
        const stockSearchInput = document.getElementById('stockSearchInput');
        const stockSearchBtn = document.getElementById('stockSearchBtn');
        const refreshClientsBtn = document.getElementById('refreshClientsBtn');
        const refreshStockBtn = document.getElementById('refreshStockBtn');
        const serviceTypeSelect = document.getElementById('serviceType');
        const profileAssignedSelect = document.getElementById('profileAssigned');
        const messageContainer = document.getElementById('messageContainer');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFile = document.getElementById('importFile');
        const backupClientsBtn = document.getElementById('backupClientsBtn');
        const backupStockBtn = document.getElementById('backupStockBtn');
        const fileList = document.getElementById('fileList');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileTabsContainer = document.getElementById('mobileTabs');
        
        // Elementos del modal de edición
        const editStockModal = document.getElementById('editStockModal');
        const editStockForm = document.getElementById('editStockForm');
        const closeModalBtn = document.querySelectorAll('.close-modal');
        const cancelEditBtn = document.getElementById('cancelEditBtn');

        // Elementos del modal de edición de cliente
        const editClientModal = document.getElementById('editClientModal');
        const editClientForm = document.getElementById('editClientForm');
        const cancelEditClientBtn = document.getElementById('cancelEditClientBtn');
        
        // Nuevos elementos para las mejoras
        const themeBtn = document.getElementById('themeBtn');
        const themeOptions = document.getElementById('themeOptions');
        const animatedBg = document.getElementById('animatedBg');
        const musicToggle = document.getElementById('musicToggle');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const currentTimeElement = document.getElementById('currentTime');
        const currentDateElement = document.getElementById('currentDate');
        const totalClientsElement = document.getElementById('totalClients');
        const totalStockElement = document.getElementById('totalStock');
        const pendingPaymentsElement = document.getElementById('pendingPayments');

        // Estado de la aplicación
        let clients = [];
        let stock = [];
        let currentEditingStock = null;
        let currentEditingClient = null;
        let originalClients = [];
        let originalStock = [];

        // Sistema de Sesión
        class SessionManager {
            static isLoggedIn() {
                return localStorage.getItem(SESSION_KEY) === 'true';
            }

            static login() {
                localStorage.setItem(SESSION_KEY, 'true');
            }

            static logout() {
                localStorage.removeItem(SESSION_KEY);
            }
        }

        // Utilidades
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.innerHTML = `
                <i class="fas ${type === 'error' ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                ${message}
            `;
            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatPhoneNumber(phone) {
            // Si el número ya tiene el prefijo, lo mantenemos
            if (phone.startsWith('+504')) {
                return phone;
            }
            // Si solo tiene los 8 dígitos, agregamos el prefijo
            if (phone.length === 8 && /^\d+$/.test(phone)) {
                return `+504${phone}`;
            }
            return phone;
        }

        function getPhoneWithoutPrefix(phone) {
            // Remover el prefijo +504 si está presente
            return phone.replace(/^\+504/, '');
        }

        // Sistema de Archivos (simulado con localStorage)
        class FileSystem {
            static saveToFile(filename, data) {
                try {
                    const fileData = {
                        content: data,
                        timestamp: new Date().toISOString(),
                        size: JSON.stringify(data).length
                    };
                    localStorage.setItem(filename, JSON.stringify(fileData));
                    return true;
                } catch (error) {
                    console.error('Error guardando archivo:', error);
                    return false;
                }
            }

            static loadFromFile(filename) {
                try {
                    const fileData = localStorage.getItem(filename);
                    if (!fileData) return null;
                    
                    const parsed = JSON.parse(fileData);
                    return parsed.content;
                } catch (error) {
                    console.error('Error cargando archivo:', error);
                    return null;
                }
            }

            static downloadFile(filename, content, type = 'text/plain') {
                const blob = new Blob([content], { type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            static listFiles() {
                const files = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('harods_tech_')) {
                        try {
                            const fileData = JSON.parse(localStorage.getItem(key));
                            files.push({
                                name: key,
                                timestamp: fileData.timestamp,
                                size: fileData.size
                            });
                        } catch (e) {
                            // Ignorar elementos que no son archivos válidos
                        }
                    }
                }
                return files.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }
        }

        // Funciones para Clientes
        async function loadClients() {
            try {
                clientsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando clientes...</div>';
                
                const data = FileSystem.loadFromFile(DATA_FILES.clients);
                clients = data || [];
                originalClients = [...clients];
                
                renderClients();
                updateServiceOptions();
                updateStats();
            } catch (error) {
                showMessage('Error cargando clientes: ' + error.message, 'error');
                clientsList.innerHTML = '<div class="error-message">Error al cargar los clientes</div>';
            }
        }

        async function saveClients() {
            const success = FileSystem.saveToFile(DATA_FILES.clients, clients);
            if (!success) {
                showMessage('Error guardando clientes', 'error');
            }
            return success;
        }

        async function addClient(clientData) {
            try {
                const newClient = {
                    id: generateId(),
                    ...clientData,
                    phone: formatPhoneNumber(clientData.phone), // Formatear teléfono
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                clients.push(newClient);
                const success = await saveClients();
                
                if (success) {
                    showMessage('Cliente agregado exitosamente');
                    playSound('successSound');
                    await loadClients();
                    return newClient;
                } else {
                    throw new Error('Error guardando cliente');
                }
            } catch (error) {
                throw new Error('Error agregando cliente: ' + error.message);
            }
        }

        async function updateClient(clientId, clientData) {
            try {
                const index = clients.findIndex(c => c.id === clientId);
                if (index === -1) throw new Error('Cliente no encontrado');
                
                clients[index] = {
                    ...clients[index],
                    ...clientData,
                    phone: formatPhoneNumber(clientData.phone), // Formatear teléfono
                    updatedAt: new Date().toISOString()
                };
                
                const success = await saveClients();
                if (success) {
                    showMessage('Cliente actualizado exitosamente');
                    playSound('successSound');
                    await loadClients();
                    return clients[index];
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error actualizando cliente: ' + error.message);
            }
        }

        async function deleteClient(clientId) {
            try {
                clients = clients.filter(c => c.id !== clientId);
                const success = await saveClients();
                
                if (success) {
                    showMessage('Cliente eliminado exitosamente');
                    playSound('successSound');
                    await loadClients();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error eliminando cliente: ' + error.message);
            }
        }

        // Funciones para Stock
        async function loadStock() {
            try {
                stockGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando stock...</div>';
                
                const data = FileSystem.loadFromFile(DATA_FILES.stock);
                stock = data || [];
                originalStock = [...stock];
                
                renderStock();
                updateServiceOptions();
                updateStats();
            } catch (error) {
                showMessage('Error cargando stock: ' + error.message, 'error');
                stockGrid.innerHTML = '<div class="error-message">Error al cargar el stock</div>';
            }
        }

        async function saveStock() {
            const success = FileSystem.saveToFile(DATA_FILES.stock, stock);
            if (!success) {
                showMessage('Error guardando stock', 'error');
            }
            return success;
        }

        async function addStock(stockData) {
            try {
                // Crear nueva cuenta
                const newStock = {
                    id: generateId(),
                    ...stockData,
                    profiles: stockData.profiles.split(',').map(p => p.trim()),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                stock.push(newStock);
                
                const success = await saveStock();
                
                if (success) {
                    showMessage('Cuenta agregada exitosamente');
                    playSound('successSound');
                    await loadStock();
                    return stock;
                } else {
                    throw new Error('Error guardando stock');
                }
            } catch (error) {
                throw new Error('Error agregando stock: ' + error.message);
            }
        }

        async function updateStock(stockId, stockData) {
            try {
                const index = stock.findIndex(s => s.id === stockId);
                if (index === -1) throw new Error('Stock no encontrado');
                
                stock[index] = {
                    ...stock[index],
                    ...stockData,
                    profiles: stockData.profiles.split(',').map(p => p.trim()),
                    updatedAt: new Date().toISOString()
                };
                
                const success = await saveStock();
                if (success) {
                    showMessage('Cuenta actualizada exitosamente');
                    playSound('successSound');
                    await loadStock();
                    return stock[index];
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error actualizando stock: ' + error.message);
            }
        }

        async function deleteStock(stockId) {
            try {
                stock = stock.filter(s => s.id !== stockId);
                const success = await saveStock();
                
                if (success) {
                    showMessage('Cuenta eliminada exitosamente');
                    playSound('successSound');
                    await loadStock();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error eliminando stock: ' + error.message);
            }
        }

        async function assignProfile(stockId, profileName) {
            try {
                const stockItem = stock.find(s => s.id === stockId);
                if (!stockItem) throw new Error('Cuenta no encontrada');
                
                const profileIndex = stockItem.profiles.indexOf(profileName);
                if (profileIndex === -1) throw new Error('Perfil no disponible');
                
                // Remover perfil y reducir cantidad
                stockItem.profiles.splice(profileIndex, 1);
                stockItem.quantity -= 1;
                stockItem.updatedAt = new Date().toISOString();
                
                const success = await saveStock();
                if (success) {
                    showMessage('Perfil asignado exitosamente');
                    playSound('successSound');
                    await loadStock();
                } else {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error asignando perfil: ' + error.message);
            }
        }

        async function releaseProfile(stockId, profileName) {
            try {
                const stockItem = stock.find(s => s.id === stockId);
                if (!stockItem) throw new Error('Cuenta no encontrada');
                
                // Agregar perfil y aumentar cantidad
                stockItem.profiles.push(profileName);
                stockItem.quantity += 1;
                stockItem.updatedAt = new Date().toISOString();
                
                const success = await saveStock();
                if (!success) {
                    throw new Error('Error guardando cambios');
                }
            } catch (error) {
                throw new Error('Error liberando perfil: ' + error.message);
            }
        }

        // Funciones de Renderizado
        function renderClients() {
            clientsList.innerHTML = '';
            
            if (clients.length === 0) {
                clientsList.innerHTML = '<div class="client-item">No se encontraron clientes</div>';
                return;
            }
            
            clients.forEach(client => {
                const clientItem = document.createElement('div');
                clientItem.className = 'client-item';
                
                const statusClass = `status-${client.status}`;
                const statusText = client.status === 'paid' ? 'Pagado' : 
                                 client.status === 'overdue' ? 'Vencido' : 'Pendiente';
                
                clientItem.innerHTML = `
                    <div class="client-info">
                        <div class="client-name">${client.name}</div>
                        <div class="client-details">
                            <div><strong>Teléfono:</strong> ${client.phone}</div>
                            <div><strong>Cuenta:</strong> ${client.accountName} - ${client.profile}</div>
                            <div><strong>Compra:</strong> ${formatDate(client.purchaseDate)}</div>
                            <div><strong>Vence:</strong> ${formatDate(client.paymentDeadline)}</div>
                            <div><strong>Acceso:</strong> ${client.loginDetails}</div>
                            <div class="${statusClass}"><strong>Estado:</strong> ${statusText}</div>
                            ${client.notes ? `<div><strong>Notas:</strong> ${client.notes}</div>` : ''}
                        </div>
                    </div>
                    <div class="client-actions">
                        <button class="btn btn-warning" onclick="handleEditClient('${client.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-success" onclick="handleSendReminder('${client.id}')">
                            <i class="fas fa-bell"></i> Recordatorio
                        </button>
                        <button class="btn btn-primary" onclick="handleMarkAsPaid('${client.id}')">
                            <i class="fas fa-check-circle"></i> Pagado
                        </button>
                        <button class="btn btn-danger" onclick="handleCancelSubscription('${client.id}')">
                            <i class="fas fa-times-circle"></i> Cancelar
                        </button>
                    </div>
                `;
                
                clientsList.appendChild(clientItem);
            });
        }

        function renderStock() {
            stockGrid.innerHTML = '';
            
            if (stock.length === 0) {
                stockGrid.innerHTML = '<div class="stock-item">No se encontraron cuentas en stock</div>';
                return;
            }
            
            stock.forEach(item => {
                const stockCard = document.createElement('div');
                stockCard.className = `stock-card ${item.service.toLowerCase().replace('+', '').replace(' ', '')}`;
                
                let stockClass = '';
                if (item.quantity === 0) {
                    stockClass = 'low-stock';
                } else if (item.quantity <= item.total * 0.3) {
                    stockClass = 'low-stock';
                } else if (item.quantity <= item.total * 0.6) {
                    stockClass = 'medium-stock';
                } else {
                    stockClass = 'high-stock';
                }
                
                stockCard.innerHTML = `
                    <div class="stock-header">
                        <div class="stock-title">${item.accountName || item.service}</div>
                        <div class="stock-count ${stockClass}">${item.quantity}/${item.total}</div>
                    </div>
                    <div class="stock-details">
                        <div><strong>Servicio:</strong> ${item.service}</div>
                        <div><strong>Email:</strong> ${item.email}</div>
                        <div><strong>Precio:</strong> $${item.price}</div>
                    </div>
                    <div class="stock-profiles">
                        <div><strong>Perfiles disponibles (${item.profiles.length}):</strong></div>
                        ${item.profiles.map(profile => `
                            <div class="profile-item">
                                <span>${profile}</span>
                                <span>
                                    <button class="btn btn-primary btn-sm" onclick="handleAssignProfile('${item.id}', '${profile}')">
                                        <i class="fas fa-user-plus"></i> Asignar
                                    </button>
                                </span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="stock-actions-card">
                        <button class="btn btn-warning" onclick="handleEditStock('${item.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger" onclick="handleDeleteStock('${item.id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                stockGrid.appendChild(stockCard);
            });
        }

        function updateServiceOptions() {
            serviceTypeSelect.innerHTML = '<option value="">Selecciona una cuenta</option>';
            profileAssignedSelect.innerHTML = '<option value="">Primero selecciona una cuenta</option>';
            
            stock.forEach(item => {
                if (item.quantity > 0) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.accountName || item.service} (${item.quantity} disponibles)`;
                    serviceTypeSelect.appendChild(option);
                }
            });
        }

        function updateProfileOptions(stockId) {
            profileAssignedSelect.innerHTML = '<option value="">Selecciona un perfil</option>';
            
            const stockItem = stock.find(s => s.id === stockId);
            if (stockItem && stockItem.profiles.length > 0) {
                stockItem.profiles.forEach(profile => {
                    const option = document.createElement('option');
                    option.value = profile;
                    option.textContent = profile;
                    profileAssignedSelect.appendChild(option);
                });
            }
        }

        function updateEditServiceOptions() {
            const editServiceTypeSelect = document.getElementById('editServiceType');
            editServiceTypeSelect.innerHTML = '<option value="">Selecciona una cuenta</option>';
            
            stock.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.accountName || item.service} (${item.quantity} disponibles)`;
                editServiceTypeSelect.appendChild(option);
            });
        }

        function updateEditProfileOptions(stockId) {
            const editProfileAssignedSelect = document.getElementById('editProfileAssigned');
            editProfileAssignedSelect.innerHTML = '<option value="">Selecciona un perfil</option>';
            
            const stockItem = stock.find(s => s.id === stockId);
            if (stockItem && stockItem.profiles.length > 0) {
                stockItem.profiles.forEach(profile => {
                    const option = document.createElement('option');
                    option.value = profile;
                    option.textContent = profile;
                    editProfileAssignedSelect.appendChild(option);
                });
            }
        }

        // Funciones del Modal de Edición
        function openEditStockModal(stockId) {
            const stockItem = stock.find(s => s.id === stockId);
            if (!stockItem) {
                showMessage('Cuenta no encontrada', 'error');
                return;
            }

            currentEditingStock = stockItem;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('editStockId').value = stockItem.id;
            document.getElementById('editServiceName').value = stockItem.service;
            document.getElementById('editAccountName').value = stockItem.accountName || stockItem.service;
            document.getElementById('editStockQuantity').value = stockItem.quantity;
            document.getElementById('editTotalCapacity').value = stockItem.total;
            document.getElementById('editAccountEmail').value = stockItem.email;
            document.getElementById('editAccountPassword').value = stockItem.password;
            document.getElementById('editProfilesAvailable').value = stockItem.profiles.join(', ');
            document.getElementById('editServicePrice').value = stockItem.price;
            
            editStockModal.style.display = 'flex';
        }

        function closeEditStockModal() {
            editStockModal.style.display = 'none';
            currentEditingStock = null;
            editStockForm.reset();
        }

        function openEditClientModal(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) {
                showMessage('Cliente no encontrado', 'error');
                return;
            }

            currentEditingClient = client;
            
            // Actualizar opciones de servicios
            updateEditServiceOptions();
            
            // Llenar el formulario con los datos actuales
            document.getElementById('editClientId').value = client.id;
            document.getElementById('editClientName').value = client.name;
            document.getElementById('editClientPhone').value = getPhoneWithoutPrefix(client.phone);
            document.getElementById('editPurchaseDate').value = client.purchaseDate;
            document.getElementById('editPaymentDeadline').value = client.paymentDeadline;
            document.getElementById('editLoginDetails').value = client.loginDetails;
            document.getElementById('editPaymentStatus').value = client.status;
            document.getElementById('editClientNotes').value = client.notes || '';
            
            // Establecer la cuenta de servicio y perfil actual
            setTimeout(() => {
                if (client.stockId) {
                    document.getElementById('editServiceType').value = client.stockId;
                    updateEditProfileOptions(client.stockId);
                    
                    // Establecer el perfil actual después de cargar las opciones
                    setTimeout(() => {
                        document.getElementById('editProfileAssigned').value = client.profile;
                    }, 100);
                }
            }, 100);
            
            editClientModal.style.display = 'flex';
        }

        function closeEditClientModal() {
            editClientModal.style.display = 'none';
            currentEditingClient = null;
            editClientForm.reset();
        }

        // Funciones de Respaldo
        function exportAllData() {
            const data = {
                clients: clients,
                stock: stock,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const content = JSON.stringify(data, null, 2);
            const filename = `harods_tech_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Datos exportados exitosamente');
            playSound('successSound');
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.clients && data.stock) {
                        clients = data.clients;
                        stock = data.stock;
                        
                        saveClients();
                        saveStock();
                        
                        loadClients();
                        loadStock();
                        
                        showMessage('Datos importados exitosamente');
                        playSound('successSound');
                    } else {
                        showMessage('Archivo de respaldo inválido', 'error');
                        playSound('errorSound');
                    }
                } catch (error) {
                    showMessage('Error importando datos: ' + error.message, 'error');
                    playSound('errorSound');
                }
            };
            reader.readAsText(file);
        }

        function backupClients() {
            const content = JSON.stringify(clients, null, 2);
            const filename = `clientes_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Clientes respaldados exitosamente');
            playSound('successSound');
        }

        function backupStock() {
            const content = JSON.stringify(stock, null, 2);
            const filename = `stock_respaldo_${new Date().toISOString().split('T')[0]}.json`;
            FileSystem.downloadFile(filename, content, 'application/json');
            showMessage('Stock respaldado exitosamente');
            playSound('successSound');
        }

        function renderFileList() {
            const files = FileSystem.listFiles();
            fileList.innerHTML = '';
            
            if (files.length === 0) {
                fileList.innerHTML = '<div class="client-item">No hay archivos de datos</div>';
                return;
            }
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'client-item';
                fileItem.innerHTML = `
                    <div class="client-info">
                        <div class="client-name">${file.name}</div>
                        <div class="client-details">
                            <div><strong>Fecha:</strong> ${new Date(file.timestamp).toLocaleString()}</div>
                            <div><strong>Tamaño:</strong> ${file.size} bytes</div>
                        </div>
                    </div>
                    <div class="client-actions">
                        <button class="btn btn-primary" onclick="downloadFile('${file.name}')">
                            <i class="fas fa-download"></i> Descargar
                        </button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function downloadFile(filename) {
            const content = localStorage.getItem(filename);
            if (content) {
                FileSystem.downloadFile(filename, content, 'application/json');
                playSound('successSound');
            }
        }

        // Funciones de búsqueda
        function searchClients(term) {
            if (!term) {
                clients = [...originalClients];
            } else {
                clients = originalClients.filter(client => 
                    client.name.toLowerCase().includes(term) || 
                    client.phone.includes(term) ||
                    (client.accountName && client.accountName.toLowerCase().includes(term)) ||
                    client.service.toLowerCase().includes(term)
                );
            }
            renderClients();
        }

        function searchStock(term) {
            if (!term) {
                stock = [...originalStock];
            } else {
                stock = originalStock.filter(item => 
                    (item.accountName && item.accountName.toLowerCase().includes(term)) ||
                    item.service.toLowerCase().includes(term) ||
                    item.email.toLowerCase().includes(term)
                );
            }
            renderStock();
        }

        // Manejadores de Eventos
        async function handleSendReminder(clientId) {
            try {
                const client = clients.find(c => c.id === clientId);
                const message = `Hola ${client.name}, este es un recordatorio de que tu pago para ${client.service} vence el ${formatDate(client.paymentDeadline)}. - Harod's Tech`;
                const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
                showMessage('Recordatorio enviado por WhatsApp');
                playSound('successSound');
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleMarkAsPaid(clientId) {
            try {
                await updateClient(clientId, { status: 'paid' });
                
                const client = clients.find(c => c.id === clientId);
                const message = `Hola ${client.name}, hemos registrado tu pago para ${client.service}. ¡Gracias! - Harod's Tech`;
                const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleCancelSubscription(clientId) {
            const client = clients.find(c => c.id === clientId);
            
            if (!confirm(`¿Estás seguro de cancelar la suscripción de ${client.name}?`)) {
                return;
            }
            
            try {
                // Liberar el perfil en el stock
                await releaseProfile(client.stockId, client.profile);
                
                // Eliminar el cliente
                await deleteClient(clientId);
                
                const message = `Hola ${client.name}, tu suscripción para ${client.service} ha sido cancelada. - Harod's Tech`;
                const whatsappUrl = `https://wa.me/${client.phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleAssignProfile(stockId, profileName) {
            try {
                await assignProfile(stockId, profileName);
                
                // Cambiar a la pestaña de agregar cliente
                switchTab('addClient');
                
                // Rellenar automáticamente la cuenta y perfil
                const stockItem = stock.find(s => s.id === stockId);
                if (stockItem) {
                    document.getElementById('serviceType').value = stockId;
                    updateProfileOptions(stockId);
                    document.getElementById('profileAssigned').value = profileName;
                    
                    // Llenar automáticamente los detalles de acceso
                    document.getElementById('loginDetails').value = `Email: ${stockItem.email}\nContraseña: ${stockItem.password}`;
                }
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        async function handleEditStock(stockId) {
            openEditStockModal(stockId);
        }

        async function handleEditClient(clientId) {
            openEditClientModal(clientId);
        }

        async function handleDeleteStock(stockId) {
            const stockItem = stock.find(s => s.id === stockId);
            if (!stockItem) return;
            
            if (!confirm(`¿Estás seguro de eliminar la cuenta ${stockItem.accountName || stockItem.service}?`)) {
                return;
            }
            
            try {
                await deleteStock(stockId);
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        }

        // Función para cambiar pestañas
        function switchTab(tabId) {
            tabs.forEach(t => t.classList.remove('active'));
            mobileTabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(tc => tc.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            if (tabId === 'backup') {
                renderFileList();
            }
            
            // Ocultar menú móvil después de seleccionar una pestaña
            if (window.innerWidth <= 768) {
                mobileTabsContainer.style.display = 'none';
            }
        }

        // Funciones para las nuevas mejoras
        function initThemeSelector() {
            const themes = {
                'default': { 
                    primary: '#2c3e50', 
                    secondary: '#3498db',
                    dark: '#34495e',
                    light: '#ecf0f1'
                },
                'dark': { 
                    primary: '#1a1a1a', 
                    secondary: '#9b59b6',
                    dark: '#ecf0f1',
                    light: '#2c3e50'
                },
                'green': { 
                    primary: '#27ae60', 
                    secondary: '#2ecc71',
                    dark: '#34495e',
                    light: '#ecf0f1'
                },
                'purple': { 
                    primary: '#8e44ad', 
                    secondary: '#9b59b6',
                    dark: '#34495e',
                    light: '#ecf0f1'
                }
            };

            const themeBtns = document.querySelectorAll('.theme-option');
            themeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    applyTheme(themes[theme]);
                    themeOptions.style.display = 'none';
                });
            });
            
            // Aplicar tema guardado si existe
            const savedTheme = localStorage.getItem('harods_tech_theme');
            if (savedTheme && themes[savedTheme]) {
                applyTheme(themes[savedTheme]);
            }
        }

        function applyTheme(theme) {
            document.documentElement.style.setProperty('--primary', theme.primary);
            document.documentElement.style.setProperty('--secondary', theme.secondary);
            document.documentElement.style.setProperty('--dark', theme.dark);
            document.documentElement.style.setProperty('--light', theme.light);
            
            // Guardar tema en localStorage
            localStorage.setItem('harods_tech_theme', 
                Object.keys(themes).find(key => 
                    themes[key].primary === theme.primary && 
                    themes[key].secondary === theme.secondary
                ) || 'default'
            );
        }

        function createParticles() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 100 + 50 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                animatedBg.appendChild(particle);
            }
        }

        function updateClock() {
            const now = new Date();
            currentTimeElement.textContent = now.toLocaleTimeString('es-HN');
            currentDateElement.textContent = now.toLocaleDateString('es-HN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function updateStats() {
            totalClientsElement.textContent = clients.length;
            totalStockElement.textContent = stock.length;
            pendingPaymentsElement.textContent = clients.filter(c => c.status === 'pending').length;
        }

        function initMusicPlayer() {
            musicToggle.addEventListener('click', function() {
                if (backgroundMusic.paused) {
                    // En un entorno real, aquí se cargaría la música
                    // backgroundMusic.src = 'background-music.mp3';
                    // backgroundMusic.play().catch(e => console.log('Error reproduciendo música:', e));
                    this.innerHTML = '<i class="fas fa-music"></i> Música: ON';
                    showMessage('Funcionalidad de música activada (en un entorno real se reproduciría música)');
                } else {
                    backgroundMusic.pause();
                    this.innerHTML = '<i class="fas fa-music"></i> Música: OFF';
                }
            });
        }

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Audio error:', e));
            }
        }

        function initDarkMode() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
            
            if (prefersDark.matches && !localStorage.getItem('harods_tech_theme')) {
                applyTheme({
                    primary: '#1a1a1a',
                    secondary: '#9b59b6',
                    dark: '#ecf0f1',
                    light: '#2c3e50'
                });
            }
            
            prefersDark.addListener((e) => {
                if (e.matches && !localStorage.getItem('harods_tech_theme')) {
                    applyTheme({
                        primary: '#1a1a1a',
                        secondary: '#9b59b6',
                        dark: '#ecf0f1',
                        light: '#2c3e50'
                    });
                }
            });
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay sesión activa
            if (SessionManager.isLoggedIn()) {
                loginSection.style.display = 'none';
                dashboard.style.display = 'block';
                showMessage('Sesión recuperada correctamente');
            } else {
                loginSection.style.display = 'block';
                dashboard.style.display = 'none';
            }

            // Establecer fechas por defecto
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthFormatted = nextMonth.toISOString().split('T')[0];
            
            document.getElementById('purchaseDate').value = today;
            document.getElementById('paymentDeadline').value = nextMonthFormatted;
            
            // Cargar datos iniciales
            loadClients();
            loadStock();
            renderFileList();
            
            // Inicializar nuevas funcionalidades
            initThemeSelector();
            createParticles();
            setInterval(updateClock, 1000);
            updateClock();
            setInterval(updateStats, 5000);
            initMusicPlayer();
            initDarkMode();
            
            // Agregar efectos de sonido a botones importantes
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => playSound('clickSound'));
            });
        });

        // Event Listeners
        loginBtn.addEventListener('click', function() {
            if (passwordInput.value === ACCESS_PASSWORD) {
                SessionManager.login();
                loginSection.style.display = 'none';
                dashboard.style.display = 'block';
                showMessage('Sesión iniciada correctamente');
                playSound('successSound');
            } else {
                showMessage('Contraseña incorrecta. Solo el propietario puede acceder.', 'error');
                playSound('errorSound');
                passwordInput.value = '';
            }
        });

        logoutBtn.addEventListener('click', function() {
            SessionManager.logout();
            dashboard.style.display = 'none';
            loginSection.style.display = 'block';
            passwordInput.value = '';
            showMessage('Sesión cerrada correctamente');
            playSound('successSound');
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        mobileTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        mobileMenuBtn.addEventListener('click', function() {
            if (mobileTabsContainer.style.display === 'flex') {
                mobileTabsContainer.style.display = 'none';
            } else {
                mobileTabsContainer.style.display = 'flex';
            }
        });

        themeBtn.addEventListener('click', function() {
            if (themeOptions.style.display === 'block') {
                themeOptions.style.display = 'none';
            } else {
                themeOptions.style.display = 'block';
            }
        });

        // Cerrar selector de temas al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!themeBtn.contains(e.target) && !themeOptions.contains(e.target)) {
                themeOptions.style.display = 'none';
            }
        });

        addClientForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockId = document.getElementById('serviceType').value;
            const stockItem = stock.find(s => s.id === stockId);
            
            if (!stockItem) {
                showMessage('Por favor selecciona una cuenta válida', 'error');
                playSound('errorSound');
                return;
            }
            
            const clientData = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                service: stockItem.service,
                accountName: stockItem.accountName || stockItem.service,
                profile: document.getElementById('profileAssigned').value,
                stockId: stockId,
                purchaseDate: document.getElementById('purchaseDate').value,
                paymentDeadline: document.getElementById('paymentDeadline').value,
                loginDetails: document.getElementById('loginDetails').value,
                status: document.getElementById('paymentStatus').value,
                notes: document.getElementById('clientNotes').value
            };
            
            try {
                await addClient(clientData);
                addClientForm.reset();
                
                // Restablecer fechas
                const today = new Date().toISOString().split('T')[0];
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                const nextMonthFormatted = nextMonth.toISOString().split('T')[0];
                
                document.getElementById('purchaseDate').value = today;
                document.getElementById('paymentDeadline').value = nextMonthFormatted;
                
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        addStockForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockData = {
                service: document.getElementById('serviceName').value,
                accountName: document.getElementById('accountName').value,
                quantity: parseInt(document.getElementById('stockQuantity').value),
                total: parseInt(document.getElementById('totalCapacity').value),
                email: document.getElementById('accountEmail').value,
                password: document.getElementById('accountPassword').value,
                profiles: document.getElementById('profilesAvailable').value,
                price: parseFloat(document.getElementById('servicePrice').value)
            };
            
            try {
                await addStock(stockData);
                addStockForm.reset();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        // Eventos del modal de edición
        editStockForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockData = {
                service: document.getElementById('editServiceName').value,
                accountName: document.getElementById('editAccountName').value,
                quantity: parseInt(document.getElementById('editStockQuantity').value),
                total: parseInt(document.getElementById('editTotalCapacity').value),
                email: document.getElementById('editAccountEmail').value,
                password: document.getElementById('editAccountPassword').value,
                profiles: document.getElementById('editProfilesAvailable').value,
                price: parseFloat(document.getElementById('editServicePrice').value)
            };
            
            try {
                await updateStock(currentEditingStock.id, stockData);
                closeEditStockModal();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        editClientForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockId = document.getElementById('editServiceType').value;
            const stockItem = stock.find(s => s.id === stockId);
            
            if (!stockItem) {
                showMessage('Por favor selecciona una cuenta válida', 'error');
                playSound('errorSound');
                return;
            }
            
            const clientData = {
                name: document.getElementById('editClientName').value,
                phone: document.getElementById('editClientPhone').value,
                service: stockItem.service,
                accountName: stockItem.accountName || stockItem.service,
                profile: document.getElementById('editProfileAssigned').value,
                stockId: stockId,
                purchaseDate: document.getElementById('editPurchaseDate').value,
                paymentDeadline: document.getElementById('editPaymentDeadline').value,
                loginDetails: document.getElementById('editLoginDetails').value,
                status: document.getElementById('editPaymentStatus').value,
                notes: document.getElementById('editClientNotes').value
            };
            
            try {
                await updateClient(currentEditingClient.id, clientData);
                closeEditClientModal();
            } catch (error) {
                showMessage(error.message, 'error');
                playSound('errorSound');
            }
        });

        closeModalBtn.forEach(btn => {
            btn.addEventListener('click', function() {
                closeEditStockModal();
                closeEditClientModal();
            });
        });

        cancelEditBtn.addEventListener('click', closeEditStockModal);
        cancelEditClientBtn.addEventListener('click', closeEditClientModal);

        // Cerrar modal al hacer clic fuera
        editStockModal.addEventListener('click', function(e) {
            if (e.target === editStockModal) {
                closeEditStockModal();
            }
        });

        editClientModal.addEventListener('click', function(e) {
            if (e.target === editClientModal) {
                closeEditClientModal();
            }
        });

        serviceTypeSelect.addEventListener('change', function() {
            updateProfileOptions(this.value);
        });

        document.getElementById('editServiceType').addEventListener('change', function() {
            updateEditProfileOptions(this.value);
        });

        refreshClientsBtn.addEventListener('click', loadClients);
        refreshStockBtn.addEventListener('click', loadStock);

        searchBtn.addEventListener('click', function() {
            const searchTerm = searchInput.value.toLowerCase();
            searchClients(searchTerm);
            
            if (searchTerm) {
                showMessage(`${clients.length} clientes encontrados`);
            }
        });

        stockSearchBtn.addEventListener('click', function() {
            const searchTerm = stockSearchInput.value.toLowerCase();
            searchStock(searchTerm);
            
            if (searchTerm) {
                showMessage(`${stock.length} cuentas encontradas`);
            }
        });

        // Búsqueda en tiempo real
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            if (searchTerm.length === 0 || searchTerm.length > 2) {
                searchClients(searchTerm);
            }
        });

        stockSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            if (searchTerm.length === 0 || searchTerm.length > 2) {
                searchStock(searchTerm);
            }
        });

        // Eventos de respaldo
        exportDataBtn.addEventListener('click', exportAllData);
        
        importDataBtn.addEventListener('click', function() {
            importFile.click();
        });
        
        importFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                importData(e.target.files[0]);
            }
        });
        
        backupClientsBtn.addEventListener('click', backupClients);
        backupStockBtn.addEventListener('click', backupStock);

        // Funciones globales para los botones
        window.handleSendReminder = handleSendReminder;
        window.handleMarkAsPaid = handleMarkAsPaid;
        window.handleCancelSubscription = handleCancelSubscription;
        window.handleAssignProfile = handleAssignProfile;
        window.handleEditStock = handleEditStock;
        window.handleEditClient = handleEditClient;
        window.handleDeleteStock = handleDeleteStock;
        window.downloadFile = downloadFile;
    </script>
</body>
    </html>
